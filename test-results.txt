
> bountyexpo@1.0.0 test
> jest --no-coverage --verbose

FAIL __tests__/e2e/complete-payment-flows.test.ts
  Complete Payment Flow E2E Tests
    Full Bounty Payment Flow - Happy Path
      â”œÃ¹ should complete entire bounty payment lifecycle (50 ms)
    Bounty Cancellation Flow
      â”œÃ¹ should handle full refund when bounty is cancelled (8 ms)
      Î“ÃªÃœ should prevent refund for completed bounties (3 ms)
    Wallet Deposit and Withdrawal Flow
      â”œÃ¹ should complete deposit to wallet (2 ms)
      â”œÃ¹ should complete withdrawal from wallet (3 ms)
      Î“ÃªÃœ should prevent withdrawal with insufficient funds (1 ms)
    Escrow Management Flow
      Î“ÃªÃœ should prevent duplicate escrow creation (2 ms)
      Î“ÃªÃœ should prevent double release of escrow (5 ms)
      Î“ÃªÃœ should calculate correct platform fee on release (4 ms)
      Î“ÃªÃœ should handle custom platform fee percentages (1 ms)
    Payment Method Management Flow
      â”œÃ¹ should save payment method for future use (2 ms)
      Î“ÃªÃœ should use saved payment method for bounty payment (2 ms)
    Error Recovery and Retry Logic
      Î“ÃªÃœ should retry failed payment confirmation (139 ms)
      Î“ÃªÃœ should handle payment intent idempotency (3 ms)
      â”œÃ¹ should create outbox event for failed release (1 ms)
    Security and Validation
      Î“ÃªÃœ should validate bounty ownership before release (2 ms)
      â”œÃ¹ should validate hunter assignment before release (2 ms)
      Î“ÃªÃœ should prevent refund after release (4 ms)
      Î“ÃªÃœ should sanitize payment metadata (3 ms)
    Performance and Optimization
      Î“ÃªÃœ should batch transaction queries efficiently (4 ms)
      Î“ÃªÃœ should handle concurrent payment processing (2 ms)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Full Bounty Payment Flow - Happy Path Î“Ã‡â•‘ should complete entire bounty payment lifecycle

    expect(received).toBe(expected) // Object.is equality

    Expected: "release"
    Received: "escrow"

      190 |         .single();
      191 |
    > 192 |       expect(releaseTx.data.type).toBe('release');
          |                                   ^
      193 |       expect(releaseTx.data.amount).toBe(9500);
      194 |       expect(releaseTx.data.platform_fee).toBe(500);
      195 |

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:192:35)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Bounty Cancellation Flow Î“Ã‡â•‘ should handle full refund when bounty is cancelled

    expect(received).toBe(expected) // Object.is equality

    Expected: "refund"
    Received: "escrow"

      246 |         .single();
      247 |
    > 248 |       expect(refundTx.data.type).toBe('refund');
          |                                  ^
      249 |       expect(refundTx.data.amount).toBe(10000);
      250 |
      251 |       // Verify refund flow completed

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:248:34)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Wallet Deposit and Withdrawal Flow Î“Ã‡â•‘ should complete deposit to wallet

    TypeError: mockSupabaseClient.from(...).insert is not a function

      306 |       const depositTx = await mockSupabaseClient
      307 |         .from('wallet_transactions')
    > 308 |         .insert({
          |          ^
      309 |           user_id: 'user123',
      310 |           type: 'deposit',
      311 |           amount: 5000,

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:308:10)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Wallet Deposit and Withdrawal Flow Î“Ã‡â•‘ should complete withdrawal from wallet

    TypeError: mockSupabaseClient.from(...).insert is not a function

      347 |       const withdrawalTx = await mockSupabaseClient
      348 |         .from('wallet_transactions')
    > 349 |         .insert({
          |          ^
      350 |           user_id: 'user123',
      351 |           type: 'withdrawal',
      352 |           amount: 5000,

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:349:10)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Payment Method Management Flow Î“Ã‡â•‘ should save payment method for future use

    TypeError: Cannot read properties of undefined (reading 'create')

      458 |     it('should save payment method for future use', async () => {
      459 |       // Step 1: Create setup intent (for saving payment method)
    > 460 |       mockStripe.setupIntents.create.mockResolvedValueOnce({
          |                               ^
      461 |         id: 'seti_test123',
      462 |         client_secret: 'seti_test123_secret',
      463 |         status: 'requires_payment_method',

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:460:31)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Error Recovery and Retry Logic Î“Ã‡â•‘ should create outbox event for failed release

    TypeError: mockSupabaseClient.from(...).insert is not a function

      585 |       await mockSupabaseClient
      586 |         .from('outbox_events')
    > 587 |         .insert({
          |          ^
      588 |           event_type: 'escrow_release_retry',
      589 |           payload: releaseRequest,
      590 |           status: 'pending',

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:587:10)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Security and Validation Î“Ã‡â•‘ should validate hunter assignment before release

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      621 |       const isCorrectHunter = bounty.data.hunter_id === releaseToHunterId;
      622 |
    > 623 |       expect(isCorrectHunter).toBe(true);
          |                               ^
      624 |     });
      625 |
      626 |     it('should prevent refund after release', async () => {

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:623:31)

  console.error
    Error creating onboarding link: Error: User not found
        at StripeConnectService.createOnboardingLink (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:72:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:180:7)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.createOnboardingLink (services/api/src/services/stripe-connect-service.ts:119:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:180:7)

  console.error
    Error creating onboarding link: Error: Stripe API error
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:197:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.createOnboardingLink (services/api/src/services/stripe-connect-service.ts:119:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:204:7)

  console.error
    Error getting connect status: Error: User not found
        at StripeConnectService.getConnectStatus (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:143:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:299:7)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.getConnectStatus (services/api/src/services/stripe-connect-service.ts:169:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:299:7)

  console.error
    Î“Â¥Ã® Error creating escrow PaymentIntent for bounty invalid_bounty: Error: Bounty not found
        at StripeConnectService.createEscrowPaymentIntent (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:192:15)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:348:7)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.createEscrowPaymentIntent (services/api/src/services/stripe-connect-service.ts:251:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:348:7)

  console.error
    Î“Â¥Ã® Error refunding PaymentIntent pi_test123: TypeError: this.stripe.paymentIntents.retrieve is not a function
        at StripeConnectService.refundPaymentIntent (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:272:63)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:372:49)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.refundPaymentIntent (services/api/src/services/stripe-connect-service.ts:304:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:372:49)

  console.error
    Î“Â¥Ã® Error refunding PaymentIntent pi_test123: TypeError: this.stripe.paymentIntents.retrieve is not a function
        at StripeConnectService.refundPaymentIntent (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:272:63)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:392:34)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.refundPaymentIntent (services/api/src/services/stripe-connect-service.ts:304:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:392:34)

  console.error
    Î“Â¥Ã® Error refunding PaymentIntent pi_test123: TypeError: this.stripe.paymentIntents.retrieve is not a function
        at StripeConnectService.refundPaymentIntent (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:272:63)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:414:49)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.refundPaymentIntent (services/api/src/services/stripe-connect-service.ts:304:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:414:49)

  console.error
    Î“Â¥Ã® Error refunding PaymentIntent pi_test123: TypeError: this.stripe.paymentIntents.retrieve is not a function
        at StripeConnectService.refundPaymentIntent (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:272:63)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:428:30)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.refundPaymentIntent (services/api/src/services/stripe-connect-service.ts:304:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:428:30)

  console.error
    Error handling webhook: Error: STRIPE_WEBHOOK_SECRET not configured
        at StripeConnectService.handleWebhook (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:398:15)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:520:30)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.handleWebhook (services/api/src/services/stripe-connect-service.ts:415:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:520:30)

  console.error
    Error handling webhook: Error: STRIPE_WEBHOOK_SECRET not configured
        at StripeConnectService.handleWebhook (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:398:15)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:541:30)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.handleWebhook (services/api/src/services/stripe-connect-service.ts:415:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:541:30)

  console.error
    Error handling webhook: Error: STRIPE_WEBHOOK_SECRET not configured
        at StripeConnectService.handleWebhook (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:398:15)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:559:30)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.handleWebhook (services/api/src/services/stripe-connect-service.ts:415:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:559:30)

  console.error
    Error handling webhook: Error: STRIPE_WEBHOOK_SECRET not configured
        at StripeConnectService.handleWebhook (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:398:15)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:568:30)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.handleWebhook (services/api/src/services/stripe-connect-service.ts:415:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:568:30)

  console.error
    Error getting connect status: Error: Database connection failed
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:593:15)
        at C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-environment-node\node_modules\jest-mock\build\index.js:305:39
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-environment-node\node_modules\jest-mock\build\index.js:312:13)
        at Object.mockConstructor [as select] (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-environment-node\node_modules\jest-mock\build\index.js:102:19)
        at StripeConnectService.getConnectStatus (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:137:10)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:597:30)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.getConnectStatus (services/api/src/services/stripe-connect-service.ts:169:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:597:30)

  console.error
    Error getting connect status: Error: Database connection failed
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:593:15)
        at C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-environment-node\node_modules\jest-mock\build\index.js:305:39
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-environment-node\node_modules\jest-mock\build\index.js:312:13)
        at Object.mockConstructor [as select] (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-environment-node\node_modules\jest-mock\build\index.js:102:19)
        at StripeConnectService.getConnectStatus (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:137:10)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:608:30)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.getConnectStatus (services/api/src/services/stripe-connect-service.ts:169:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:608:30)

  console.error
    Î“Â¥Ã® Error creating escrow PaymentIntent for bounty bounty123: Error: Database connection failed
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:593:15)
        at C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-environment-node\node_modules\jest-mock\build\index.js:305:39
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-environment-node\node_modules\jest-mock\build\index.js:312:13)
        at Object.mockConstructor [as select] (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-environment-node\node_modules\jest-mock\build\index.js:102:19)
        at StripeConnectService.createEscrowPaymentIntent (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\services\api\src\services\stripe-connect-service.ts:186:10)
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\stripe-connect-service.test.ts:618:30)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at StripeConnectService.createEscrowPaymentIntent (services/api/src/services/stripe-connect-service.ts:251:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:618:30)

FAIL __tests__/integration/edit-profile-flow.test.ts
  Edit Profile Integration Flow
    Profile Loading
      Î“ÃªÃœ should load profile data successfully (84 ms)
      Î“ÃªÃœ should handle profile loading errors (2 ms)
      Î“ÃªÃœ should notify listeners when profile loads (6 ms)
    Profile Update
      â”œÃ¹ should update profile successfully (5 ms)
      Î“ÃªÃœ should handle validation errors (3 ms)
      â”œÃ¹ should update avatar URL (3 ms)
    Avatar Upload Flow
      â”œÃ¹ should upload avatar and update profile (5 ms)
      Î“ÃªÃœ should handle upload failure and retry (162 ms)
      Î“ÃªÃœ should fail after max retries (252 ms)
    Form Validation
      Î“ÃªÃœ should validate bio length (2 ms)
      Î“ÃªÃœ should validate username format (8 ms)
      Î“ÃªÃœ should parse comma-separated skills (2 ms)
      Î“ÃªÃœ should handle empty skills (1 ms)
    Data Isolation
      Î“ÃªÃœ should clear data when user changes (6 ms)
      Î“ÃªÃœ should use current session user ID for operations (2 ms)
    Error Recovery
      Î“ÃªÃœ should handle network errors gracefully (4 ms)
      Î“ÃªÃœ should handle database constraint violations (2 ms)
      Î“ÃªÃœ should handle rate limiting (10 ms)
    Complete Edit Flow
      â”œÃ¹ should complete full profile edit flow (4 ms)
      Î“ÃªÃœ should rollback on save failure (3 ms)
    Concurrent Operations
      â”œÃ¹ should handle simultaneous profile updates (2 ms)

  Î“Ã¹Ã… Edit Profile Integration Flow Î“Ã‡â•‘ Profile Update Î“Ã‡â•‘ should update profile successfully

    expect(received).not.toBeNull()

    Received: null

      158 |       });
      159 |
    > 160 |       expect(result).not.toBeNull();
          |                          ^
      161 |       expect(result?.username).toBe('johndoe_updated');
      162 |       expect(result?.about).toBe('Updated bio');
      163 |     });

      at Object.<anonymous> (__tests__/integration/edit-profile-flow.test.ts:160:26)

  Î“Ã¹Ã… Edit Profile Integration Flow Î“Ã‡â•‘ Profile Update Î“Ã‡â•‘ should update avatar URL

    expect(received).not.toBeNull()

    Received: null

      205 |       } as any);
      206 |
    > 207 |       expect(result).not.toBeNull();
          |                          ^
      208 |       expect(result?.avatar).toBe(avatarUrl);
      209 |     });
      210 |   });

      at Object.<anonymous> (__tests__/integration/edit-profile-flow.test.ts:207:26)

  Î“Ã¹Ã… Edit Profile Integration Flow Î“Ã‡â•‘ Avatar Upload Flow Î“Ã‡â•‘ should upload avatar and update profile

    expect(received).toBe(expected) // Object.is equality

    Expected: "https://storage.example.com/avatars/123-avatar.jpg"
    Received: undefined

      255 |       } as any);
      256 |
    > 257 |       expect(result?.avatar).toBe(uploadedUrl);
          |                              ^
      258 |     });
      259 |
      260 |     it('should handle upload failure and retry', async () => {

      at Object.<anonymous> (__tests__/integration/edit-profile-flow.test.ts:257:30)

  Î“Ã¹Ã… Edit Profile Integration Flow Î“Ã‡â•‘ Complete Edit Flow Î“Ã‡â•‘ should complete full profile edit flow

    expect(received).not.toBeNull()

    Received: null

      563 |       } as any);
      564 |
    > 565 |       expect(result).not.toBeNull();
          |                          ^
      566 |       expect(result?.username).toBe('johndoe_new');
      567 |       expect(result?.about).toBe('Updated developer bio');
      568 |       expect(result?.avatar).toBe(avatarUrl);

      at Object.<anonymous> (__tests__/integration/edit-profile-flow.test.ts:565:26)

  Î“Ã¹Ã… Edit Profile Integration Flow Î“Ã‡â•‘ Concurrent Operations Î“Ã‡â•‘ should handle simultaneous profile updates

    expect(received).not.toBeNull()

    Received: null

      627 |       
      628 |       // Both should complete without crashing
    > 629 |       expect(results[0]).not.toBeNull();
          |                              ^
      630 |       expect(results[1]).not.toBeNull();
      631 |     });
      632 |   });

      at Object.<anonymous> (__tests__/integration/edit-profile-flow.test.ts:629:30)

FAIL services/api/src/__tests__/bank-accounts.test.ts
  Bank Account Management
    addBankAccount
      Î“ÃªÃœ should add a bank account successfully (7 ms)
      â”œÃ¹ should handle invalid routing number from Stripe API (1 ms)
    listBankAccounts
      Î“ÃªÃœ should list bank accounts successfully (3 ms)
      â”œÃ¹ should return empty array if no Connect account (10 ms)
    removeBankAccount
      Î“ÃªÃœ should remove a bank account successfully (1 ms)
    setDefaultBankAccount
      Î“ÃªÃœ should set a bank account as default (1 ms)

  Î“Ã¹Ã… Bank Account Management Î“Ã‡â•‘ addBankAccount Î“Ã‡â•‘ should handle invalid routing number from Stripe API

    TypeError: Cannot read properties of undefined (reading 'mock')

       99 |       const { default: Stripe } = require('stripe');
      100 |       const stripeMock = Stripe as jest.MockedClass<typeof Stripe>;
    > 101 |       const stripeInstance = stripeMock.mock.results[0].value;
          |                                         ^
      102 |       
      103 |       stripeInstance.tokens.create.mockRejectedValueOnce({
      104 |         type: 'StripeInvalidRequestError',

      at Object.<anonymous> (services/api/src/__tests__/bank-accounts.test.ts:101:41)

  Î“Ã¹Ã… Bank Account Management Î“Ã‡â•‘ listBankAccounts Î“Ã‡â•‘ should return empty array if no Connect account

    expect(received).toEqual(expected) // deep equality

    - Expected  -  1
    + Received  + 12

    - Array []
    + Array [
    +   Object {
    +     "accountHolderName": "John Doe",
    +     "accountType": "checking",
    +     "bankName": "STRIPE TEST BANK",
    +     "default": true,
    +     "id": "ba_test_123456",
    +     "last4": "6789",
    +     "routingNumber": "110000000",
    +     "status": "verified",
    +   },
    + ]

      148 |
      149 |       const result = await consolidatedStripeConnectService.listBankAccounts('user_no_account');
    > 150 |       expect(result).toEqual([]);
          |                      ^
      151 |     });
      152 |   });
      153 |

      at Object.<anonymous> (services/api/src/__tests__/bank-accounts.test.ts:150:22)

FAIL __tests__/unit/services/stripe-connect-service.test.ts (5.102 s)
  Stripe Connect Service
    createOnboardingLink
      Î“ÃªÃœ should create onboarding link for new Stripe account (23 ms)
      â”œÃ¹ should create onboarding link for existing Stripe account (7 ms)
      Î“ÃªÃœ should use default URLs when not provided (2 ms)
      Î“ÃªÃœ should handle user not found (310 ms)
      Î“ÃªÃœ should handle Stripe account creation failure (80 ms)
      Î“ÃªÃœ should update user with new Stripe account ID (3 ms)
    getConnectStatus
      â”œÃ¹ should return connect status for user with Stripe account (5 ms)
      Î“ÃªÃœ should return status for user without Stripe account (5 ms)
      â”œÃ¹ should indicate when account requires action (2 ms)
      â”œÃ¹ should handle incomplete account setup (15 ms)
      Î“ÃªÃœ should handle user not found (63 ms)
    createEscrowPaymentIntent
      â”œÃ¹ should create escrow payment intent for bounty (7 ms)
      Î“ÃªÃœ should validate bounty exists (21 ms)
      â”œÃ¹ should handle zero amount bounties (3 ms)
    refundPaymentIntent
      â”œÃ¹ should refund a payment intent (18 ms)
      â”œÃ¹ should include refund reason in metadata (29 ms)
      â”œÃ¹ should handle partial refunds (14 ms)
      â”œÃ¹ should handle Stripe refund errors (66 ms)
    validatePaymentCapability
      â”œÃ¹ should validate user can make payment (4 ms)
      â”œÃ¹ should return error for user without Stripe account (9 ms)
      â”œÃ¹ should return error for account with charges disabled (6 ms)
      â”œÃ¹ should validate minimum payment amount (3 ms)
      Î“ÃªÃœ should handle user not found (1 ms)
    handleWebhook
      â”œÃ¹ should handle account.updated webhook (16 ms)
      â”œÃ¹ should handle payment_intent.succeeded webhook (17 ms)
      â”œÃ¹ should handle refund.created webhook (12 ms)
      Î“ÃªÃœ should validate webhook signature (35 ms)
    error handling and edge cases
      â”œÃ¹ should handle Stripe service not configured (4 ms)
      Î“ÃªÃœ should handle database connection errors (49 ms)
      Î“ÃªÃœ should handle Stripe API rate limits (41 ms)
      Î“ÃªÃœ should handle network timeouts (19 ms)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ createOnboardingLink Î“Ã‡â•‘ should create onboarding link for existing Stripe account

    expect(jest.fn()).not.toHaveBeenCalled()

    Expected number of calls: 0
    Received number of calls: 1

    1: {"capabilities": {"card_payments": {"requested": true}, "transfers": {"requested": true}}, "settings": {"payouts": {"schedule": {"interval": "daily"}}}, "type": "express"}

      146 |
      147 |       expect(result.url).toBe('https://connect.stripe.com/setup/test');
    > 148 |       expect(mockStripe.accounts.create).not.toHaveBeenCalled();
          |                                              ^
      149 |       expect(mockStripe.accountLinks.create).toHaveBeenCalledWith(
      150 |         expect.objectContaining({
      151 |           account: 'acct_test123',

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:148:46)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ getConnectStatus Î“Ã‡â•‘ should return connect status for user with Stripe account

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      232 |       const result = await stripeConnectService.getConnectStatus('user123');
      233 |
    > 234 |       expect(result.hasStripeAccount).toBe(true);
          |                                       ^
      235 |       expect(result.stripeAccountId).toBe('acct_test123');
      236 |       expect(result.detailsSubmitted).toBe(true);
      237 |       expect(result.chargesEnabled).toBe(true);

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:234:39)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ getConnectStatus Î“Ã‡â•‘ should indicate when account requires action

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

      269 |       const result = await stripeConnectService.getConnectStatus('user123');
      270 |
    > 271 |       expect(result.requiresAction).toBe(true);
          |                                     ^
      272 |       expect(result.currentlyDue).toEqual(['individual.id_number', 'individual.ssn_last_4']);
      273 |     });
      274 |

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:271:37)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ getConnectStatus Î“Ã‡â•‘ should handle incomplete account setup

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

      283 |       const result = await stripeConnectService.getConnectStatus('user123');
      284 |
    > 285 |       expect(result.detailsSubmitted).toBe(false);
          |                                       ^
      286 |       expect(result.chargesEnabled).toBe(false);
      287 |       expect(result.payoutsEnabled).toBe(false);
      288 |     });

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:285:39)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ createEscrowPaymentIntent Î“Ã‡â•‘ should create escrow payment intent for bounty

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"amount": 5000, "currency": "usd", "metadata": ObjectContaining {"bountyId": "bounty123", "type": "escrow"}}
    Received: {"amount": undefined, "capture_method": "automatic", "currency": "usd", "description": "Escrow for bounty: undefined", "metadata": {"bounty_id": "bounty123", "bounty_title": undefined, "creator_id": undefined, "type": "escrow"}, "payment_method_types": ["card"]}

    Number of calls: 1

      325 |       expect(result.clientSecret).toBe('pi_test123_secret_abc');
      326 |       expect(result.amount).toBe(5000);
    > 327 |       expect(mockStripe.paymentIntents.create).toHaveBeenCalledWith(
          |                                                ^
      328 |         expect.objectContaining({
      329 |           amount: 5000,
      330 |           currency: 'usd',

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:327:48)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ createEscrowPaymentIntent Î“Ã‡â•‘ should handle zero amount bounties

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"amount": 5000, "clientSecret": "pi_test123_secret_abc", "currency": "usd", "paymentIntentId": "pi_test123", "status": "requires_payment_method"}

      362 |       }));
      363 |
    > 364 |       await expect(
          |             ^
      365 |         stripeConnectService.createEscrowPaymentIntent('bounty123')
      366 |       ).rejects.toThrow();
      367 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:364:13)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ refundPaymentIntent Î“Ã‡â•‘ should refund a payment intent

    expect(received).toBe(expected) // Object.is equality

    Expected: "ref_test123"
    Received: undefined

      376 |       );
      377 |
    > 378 |       expect(result.id).toBe('ref_test123');
          |                         ^
      379 |       expect(result.amount).toBe(5000);
      380 |       expect(result.status).toBe('succeeded');
      381 |       expect(mockStripe.refunds.create).toHaveBeenCalledWith(

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:378:25)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ refundPaymentIntent Î“Ã‡â•‘ should include refund reason in metadata

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"metadata": ObjectContaining {"reason": "User requested cancellation"}}

    Number of calls: 0

      396 |       );
      397 |
    > 398 |       expect(mockStripe.refunds.create).toHaveBeenCalledWith(
          |                                         ^
      399 |         expect.objectContaining({
      400 |           metadata: expect.objectContaining({
      401 |             reason: 'User requested cancellation',

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:398:41)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ refundPaymentIntent Î“Ã‡â•‘ should handle partial refunds

    expect(received).toBe(expected) // Object.is equality

    Expected: 2500
    Received: undefined

      417 |       );
      418 |
    > 419 |       expect(result.amount).toBe(2500);
          |                             ^
      420 |     });
      421 |
      422 |     it('should handle Stripe refund errors', async () => {

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:419:29)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ refundPaymentIntent Î“Ã‡â•‘ should handle Stripe refund errors

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"error": "this.stripe.paymentIntents.retrieve is not a function", "success": false}

      425 |       );
      426 |
    > 427 |       await expect(
          |             ^
      428 |         stripeConnectService.refundPaymentIntent('pi_test123', 'bounty123')
      429 |       ).rejects.toThrow();
      430 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:427:13)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ validatePaymentCapability Î“Ã‡â•‘ should validate user can make payment

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      438 |       );
      439 |
    > 440 |       expect(result.canPay).toBe(true);
          |                             ^
      441 |       expect(result.error).toBeUndefined();
      442 |     });
      443 |

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:440:29)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ validatePaymentCapability Î“Ã‡â•‘ should return error for user without Stripe account

    expect(received).toBe(expected) // Object.is equality

    Expected: "No Stripe account"
    Received: "User has not set up payment method. Please complete Stripe onboarding first."

      459 |
      460 |       expect(result.canPay).toBe(false);
    > 461 |       expect(result.error).toBe('No Stripe account');
          |                            ^
      462 |     });
      463 |
      464 |     it('should return error for account with charges disabled', async () => {

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:461:28)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ validatePaymentCapability Î“Ã‡â•‘ should return error for account with charges disabled

    expect(received).toBe(expected) // Object.is equality

    Expected: "Charges not enabled"
    Received: "User has not set up payment method. Please complete Stripe onboarding first."

      474 |
      475 |       expect(result.canPay).toBe(false);
    > 476 |       expect(result.error).toBe('Charges not enabled');
          |                            ^
      477 |     });
      478 |
      479 |     it('should validate minimum payment amount', async () => {

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:476:28)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ validatePaymentCapability Î“Ã‡â•‘ should validate minimum payment amount

    expect(received).toContain(expected) // indexOf

    Expected substring: "minimum"
    Received string:    "User has not set up payment method. Please complete Stripe onboarding first."

      484 |
      485 |       expect(result.canPay).toBe(false);
    > 486 |       expect(result.error).toContain('minimum');
          |                            ^
      487 |     });
      488 |
      489 |     it('should handle user not found', async () => {

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:486:28)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ handleWebhook Î“Ã‡â•‘ should handle account.updated webhook

    expect(received).resolves.not.toThrow()

    Received promise rejected instead of resolved
    Rejected to value: [Error: STRIPE_WEBHOOK_SECRET not configured]

      517 |       const signature = 'whsec_test_signature';
      518 |
    > 519 |       await expect(
          |             ^
      520 |         stripeConnectService.handleWebhook(payload, signature)
      521 |       ).resolves.not.toThrow();
      522 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:519:13)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ handleWebhook Î“Ã‡â•‘ should handle payment_intent.succeeded webhook

    expect(received).resolves.not.toThrow()

    Received promise rejected instead of resolved
    Rejected to value: [Error: STRIPE_WEBHOOK_SECRET not configured]

      538 |       const signature = 'whsec_test_signature';
      539 |
    > 540 |       await expect(
          |             ^
      541 |         stripeConnectService.handleWebhook(payload, signature)
      542 |       ).resolves.not.toThrow();
      543 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:540:13)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ handleWebhook Î“Ã‡â•‘ should handle refund.created webhook

    expect(received).resolves.not.toThrow()

    Received promise rejected instead of resolved
    Rejected to value: [Error: STRIPE_WEBHOOK_SECRET not configured]

      556 |       const signature = 'whsec_test_signature';
      557 |
    > 558 |       await expect(
          |             ^
      559 |         stripeConnectService.handleWebhook(payload, signature)
      560 |       ).resolves.not.toThrow();
      561 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:558:13)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ error handling and edge cases Î“Ã‡â•‘ should handle Stripe service not configured

    TypeError: serviceNoConfig.createOnboardingLink is not a function

      582 |         const serviceNoConfig = require('../../../services/api/src/services/stripe-connect-service');
      583 |         await expect(
    > 584 |           serviceNoConfig.createOnboardingLink({ userId: 'user123' })
          |                           ^
      585 |         ).rejects.toThrow();
      586 |       } finally {
      587 |         process.env.STRIPE_SECRET_KEY = originalEnv;

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:584:27)

FAIL services/api/src/__tests__/idempotency.test.ts (5.482 s)
  Idempotency Service
    Basic Operations
      Î“ÃªÃœ should detect duplicate idempotency key (20 ms)
      Î“ÃªÃœ should allow reuse after key removal (2 ms)
      Î“ÃªÃœ should handle concurrent checks correctly (33 ms)
    TTL Handling
      Î“ÃªÃœ should respect custom TTL values (1155 ms)
  Payment Operations Idempotency
    Payment Intent Creation
      Î“ÃªÃœ should prevent duplicate payment intent creation (1 ms)
      Î“ÃªÃœ should allow retry after failure cleanup (1 ms)
    Wallet Operations Idempotency
      Î“ÃªÃœ should prevent duplicate deposit processing (2 ms)
      Î“ÃªÃœ should prevent duplicate escrow operations (3 ms)
      Î“ÃªÃœ should prevent duplicate release operations (4 ms)
      Î“ÃªÃœ should prevent duplicate refund operations (2 ms)
      Î“ÃªÃœ should prevent duplicate withdrawal operations (2 ms)
    Cross-Operation Isolation
      Î“ÃªÃœ should isolate different operation types (3 ms)
    Edge Cases
      â”œÃ¹ should reject empty idempotency key (8 ms)
      Î“ÃªÃœ should handle very long idempotency keys (1 ms)
      Î“ÃªÃœ should handle special characters in keys (1 ms)
  Stripe API Idempotency Integration
    Î“ÃªÃœ should use idempotency keys format compatible with Stripe (29 ms)
    Î“ÃªÃœ should generate deterministic keys for same inputs (1 ms)
    Î“ÃªÃœ should generate different keys for different inputs (1 ms)
  Idempotency Best Practices
    Î“ÃªÃœ should demonstrate proper key generation pattern (3 ms)
    Î“ÃªÃœ should demonstrate metadata storage pattern (3 ms)

  Î“Ã¹Ã… Payment Operations Idempotency Î“Ã‡â•‘ Edge Cases Î“Ã‡â•‘ should reject empty idempotency key

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

      238 |       // Empty idempotency keys should not be treated as valid keys.
      239 |       // The service is expected to reject or otherwise fail on empty input.
    > 240 |       await expect(storeIdempotencyKey(emptyKey)).rejects.toThrow();
          |             ^
      241 |       
      242 |       const check = await checkIdempotencyKey(emptyKey);
      243 |       expect(check).toBe(false);

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (services/api/src/__tests__/idempotency.test.ts:240:13)

FAIL __tests__/components/edit-profile-screen.test.tsx (5.934 s)
  EditProfileScreen
    Component Rendering
      Î“ÃªÃœ should render without crashing (156 ms)
      Î“ÃªÃœ should show loading state while profile is loading (9 ms)
      Î“ÃªÃœ should display error banner when there is an error (14 ms)
      Î“ÃªÃœ should render all form fields (48 ms)
    Keyboard Behavior
      Î“ÃªÃœ should have KeyboardAvoidingView with correct behavior on iOS (22 ms)
      Î“ÃªÃœ should have KeyboardAvoidingView with correct behavior on Android (20 ms)
      Î“ÃªÃœ should have ScrollView with keyboardShouldPersistTaps (21 ms)
      Î“ÃªÃœ should wrap only ScrollView in KeyboardAvoidingView, not entire component (30 ms)
    Form State Management
      Î“ÃªÃœ should initialize form with profile data (22 ms)
      Î“ÃªÃœ should disable Save button when form is pristine (85 ms)
      Î“ÃªÃœ should track bio character count (28 ms)
      Î“ÃªÃœ should enforce bio character limit of 160 (27 ms)
      Î“ÃªÃœ should truncate bio text exceeding 160 characters via onChangeText (21 ms)
    Focus Indicators
      Î“ÃªÃœ should have accessible focus behavior for all input fields (40 ms)
    Accessibility
      â”œÃ¹ should have proper accessibility labels on all interactive elements (22 ms)
      Î“ÃªÃœ should indicate disabled state on Save button accessibility (43 ms)
    Data Isolation and Security
      Î“ÃªÃœ should clear form data when currentUserId changes (66 ms)
      Î“ÃªÃœ should use current session user ID from session (22 ms)

  Î“Ã¹Ã… EditProfileScreen Î“Ã‡â•‘ Accessibility Î“Ã‡â•‘ should have proper accessibility labels on all interactive elements

    Found multiple elements with accessibility label: Change profile picture

      349 |       expect(getByLabelText('Cancel editing')).toBeTruthy();
      350 |       expect(getByLabelText('Change banner image')).toBeTruthy();
    > 351 |       expect(getByLabelText('Change profile picture')).toBeTruthy();
          |              ^
      352 |       expect(getByLabelText('Display name')).toBeTruthy();
      353 |       expect(getByLabelText('Username')).toBeTruthy();
      354 |       expect(getByLabelText('Bio')).toBeTruthy();

      at Object.<anonymous> (__tests__/components/edit-profile-screen.test.tsx:351:14)

[16:25:03 UTC] [32mINFO[39m: [36m[StripeConnect] Added bank account[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35muserId[39m: "user_test_123"
    [35maccountId[39m: "acct_test_123"
    [35mbankAccountId[39m: "ba_test_123456"
    [35mlast4[39m: "6789"
[16:25:03 UTC] [32mINFO[39m: [36m[StripeConnect] Removed bank account[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35muserId[39m: "user_test_123"
    [35maccountId[39m: "acct_test_123"
    [35mbankAccountId[39m: "ba_test_123456"
[16:25:03 UTC] [32mINFO[39m: [36m[StripeConnect] Set default bank account[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35muserId[39m: "user_test_123"
    [35maccountId[39m: "acct_test_123"
    [35mbankAccountId[39m: "ba_test_123456"
PASS __tests__/unit/dispute-service.test.ts
  DisputeService
    createDispute
      Î“ÃªÃœ should create a dispute with evidence (7 ms)
      Î“ÃªÃœ should handle errors gracefully (5 ms)
    uploadEvidence
      Î“ÃªÃœ should upload evidence to a dispute (21 ms)
    addComment
      Î“ÃªÃœ should add a public comment (1 ms)
      Î“ÃªÃœ should add an internal admin comment
    makeResolutionDecision
      Î“ÃªÃœ should create a resolution with fund distribution (40 ms)
    calculateSuggestedResolution
      Î“ÃªÃœ should suggest release when hunter has more evidence (3 ms)
      Î“ÃªÃœ should suggest split when evidence is balanced (1 ms)
    autoCloseStaleDisputes
      Î“ÃªÃœ should close disputes past auto_close_at date (2 ms)
    escalateUnresolvedDisputes
      Î“ÃªÃœ should escalate disputes older than 14 days (2 ms)
    createAppeal
      Î“ÃªÃœ should create an appeal for a resolved dispute (1 ms)
      Î“ÃªÃœ should fail for non-resolved disputes (1 ms)

PASS __tests__/e2e/complete-bounty-flow.test.ts
  Complete Bounty Flow E2E Tests
    User Journey 1: Create Bounty Flow
      Î“ÃªÃœ should create a paid bounty with all required fields (8 ms)
      Î“ÃªÃœ should create an honor-based bounty (no payment) (53 ms)
      Î“ÃªÃœ should validate required fields during creation (114 ms)
      Î“ÃªÃœ should prevent creating bounty with negative amount (3 ms)
    User Journey 2: Apply & Accept Flow
      Î“ÃªÃœ should list open bounties when filtering by status (6 ms)
      Î“ÃªÃœ should allow hunter to apply to bounty (43 ms)
      Î“ÃªÃœ should allow multiple hunters to apply to same bounty (3 ms)
      Î“ÃªÃœ should accept hunter application and update bounty status (4 ms)
      Î“ÃªÃœ should reject competing requests when one is accepted (4 ms)
      Î“ÃªÃœ should create conversation between poster and accepted hunter (2 ms)
      Î“ÃªÃœ should create escrow transaction for paid bounty (2 ms)
      Î“ÃªÃœ should prevent acceptance if poster has insufficient balance (2 ms)
      Î“ÃªÃœ should send notifications to all parties on acceptance (19 ms)
    User Journey 3: Work & Communication
      Î“ÃªÃœ should allow poster and hunter to exchange messages (2 ms)
      Î“ÃªÃœ should support message attachments (2 ms)
      Î“ÃªÃœ should update message status as read (2 ms)
      User Journey 4: Complete & Payment Flow
        Î“ÃªÃœ should allow hunter to mark work as complete (2 ms)
        Î“ÃªÃœ should release escrow payment on completion (2 ms)
        Î“ÃªÃœ should update wallet balances after payment release (3 ms)
        Î“ÃªÃœ should create wallet transaction records (3 ms)
        Î“ÃªÃœ should send payment notification to hunter (1 ms)
        Î“ÃªÃœ should only allow poster to release payment (5 ms)
        Î“ÃªÃœ should handle honor-based bounty completion (no payment) (2 ms)
      User Journey 5: Cancellation Flow
        Î“ÃªÃœ should allow poster to cancel bounty before acceptance (2 ms)
        Î“ÃªÃœ should handle cancellation request during work (3 ms)
        Î“ÃªÃœ should handle cancellation negotiation for in-progress bounty (26 ms)
        Î“ÃªÃœ should process refund for cancelled paid bounty (2 ms)
        Î“ÃªÃœ should notify hunter of cancellation (3 ms)
        Î“ÃªÃœ should update conversation with cancellation notice (1 ms)
      Edge Cases & Error Handling
        Î“ÃªÃœ should handle payment failure during escrow (2 ms)
        Î“ÃªÃœ should handle network errors during critical operations (2 ms)
        Î“ÃªÃœ should prevent concurrent acceptance of same bounty (3 ms)
        Î“ÃªÃœ should validate bounty status transitions (2 ms)
        Î“ÃªÃœ should handle missing required data gracefully (5 ms)
      Integration Points
        Î“ÃªÃœ should trigger notifications at key events (3 ms)
        Î“ÃªÃœ should update wallet balance correctly through lifecycle (9 ms)
        Î“ÃªÃœ should track user ratings after completion (73 ms)
        Î“ÃªÃœ should support bounty search and filtering (1 ms)

FAIL services/api/src/__tests__/risk-management.test.ts (7.218 s)
  Risk Management Service
    Risk Assessment
      â”œÃ¹ should assess user risk based on multiple factors (460 ms)
      â”œÃ¹ should give higher risk score to new accounts (28 ms)
      â”œÃ¹ should give higher risk score to unverified accounts (10 ms)
      â”œÃ¹ should recommend reserve for medium+ risk users (84 ms)
    Business Category Compliance
      â”œÃ¹ should reject prohibited business categories (52 ms)
      â”œÃ¹ should allow non-restricted categories (11 ms)
      â”œÃ¹ should provide risk level for restricted but allowed categories (38 ms)
    Risk Actions
      â”œÃ¹ should create risk action and restrict account (39 ms)
      â”œÃ¹ should send notification when taking risk action (40 ms)
    Reserve Management
      â”œÃ¹ should establish reserve for user (14 ms)
      â”œÃ¹ should calculate platform liability correctly (30 ms)
    Transaction Pattern Monitoring
      â”œÃ¹ should detect high velocity transactions (10 ms)
      â”œÃ¹ should auto-trigger action for critical velocity (55 ms)
  Remediation Service
    Workflow Creation
      â”œÃ¹ should create remediation workflow (20 ms)
      â”œÃ¹ should auto-trigger remediation for verification actions (7 ms)
    Document Submission
      â”œÃ¹ should accept document submissions (66 ms)
    Review Process
      â”œÃ¹ should approve remediation and restore account (97 ms)
      â”œÃ¹ should reject remediation with feedback (15 ms)
    Status Tracking
      â”œÃ¹ should return remediation status for user (52 ms)
      â”œÃ¹ should return pending remediations for admin (8 ms)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Risk Assessment Î“Ã‡â•‘ should assess user risk based on multiple factors

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Risk Assessment Î“Ã‡â•‘ should give higher risk score to new accounts

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Risk Assessment Î“Ã‡â•‘ should give higher risk score to unverified accounts

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Risk Assessment Î“Ã‡â•‘ should recommend reserve for medium+ risk users

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Business Category Compliance Î“Ã‡â•‘ should reject prohibited business categories

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Business Category Compliance Î“Ã‡â•‘ should allow non-restricted categories

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Business Category Compliance Î“Ã‡â•‘ should provide risk level for restricted but allowed categories

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Risk Actions Î“Ã‡â•‘ should create risk action and restrict account

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Risk Actions Î“Ã‡â•‘ should send notification when taking risk action

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Reserve Management Î“Ã‡â•‘ should establish reserve for user

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Reserve Management Î“Ã‡â•‘ should calculate platform liability correctly

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Transaction Pattern Monitoring Î“Ã‡â•‘ should detect high velocity transactions

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Transaction Pattern Monitoring Î“Ã‡â•‘ should auto-trigger action for critical velocity

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Workflow Creation Î“Ã‡â•‘ should create remediation workflow

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Workflow Creation Î“Ã‡â•‘ should auto-trigger remediation for verification actions

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Document Submission Î“Ã‡â•‘ should accept document submissions

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Review Process Î“Ã‡â•‘ should approve remediation and restore account

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Review Process Î“Ã‡â•‘ should reject remediation with feedback

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Status Tracking Î“Ã‡â•‘ should return remediation status for user

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Status Tracking Î“Ã‡â•‘ should return pending remediations for admin

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  console.error
    An update to HookContainer inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11801:19
      at runWithFiberInDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:1574:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11800:9)
      at scheduleUpdateOnFiber (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:10326:9)
      at dispatchSetStateInternal (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4148:13)
      at dispatchSetState (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4107:7)
      at hooks/useCachedData.ts:47:7

  console.error
    An update to HookContainer inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11801:19
      at runWithFiberInDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:1574:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11800:9)
      at scheduleUpdateOnFiber (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:10326:9)
      at dispatchSetStateInternal (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4148:13)
      at dispatchSetState (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4107:7)
      at hooks/useCachedData.ts:48:7

  console.error
    An update to HookContainer inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11801:19
      at runWithFiberInDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:1574:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11800:9)
      at scheduleUpdateOnFiber (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:10326:9)
      at dispatchSetStateInternal (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4148:13)
      at dispatchSetState (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4107:7)
      at hooks/useCachedData.ts:54:7

  console.error
    [AuthProvider] Error fetching session: { message: 'Invalid session', status: 401 }

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at fetchSession (providers/auth-provider.tsx:224:11)

  console.error
    [AuthProvider] Error setting session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at fetchSession (providers/auth-provider.tsx:244:13)

  console.error
    [AuthProvider] Error setting session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at fetchSession (providers/auth-provider.tsx:244:13)

PASS __tests__/integration/api/payment-endpoints.test.ts
  Payment API Integration Tests
    GET /health
      Î“ÃªÃœ should return health status (171 ms)
    POST /payments/create-payment-intent
      Î“ÃªÃœ should create payment intent with valid data (132 ms)
      Î“ÃªÃœ should reject request without authentication (15 ms)
      Î“ÃªÃœ should reject invalid amount (19 ms)
      Î“ÃªÃœ should reject negative amount (14 ms)
      Î“ÃªÃœ should handle missing amount (21 ms)
    POST /payments/escrow
      Î“ÃªÃœ should create escrow payment (19 ms)
      Î“ÃªÃœ should require bountyId (15 ms)
    POST /payments/release
      Î“ÃªÃœ should release escrow funds (33 ms)
    POST /payments/refund
      Î“ÃªÃœ should refund payment (26 ms)
    POST /payments/webhook
      Î“ÃªÃœ should process webhook with valid signature (22 ms)
      Î“ÃªÃœ should reject webhook without signature (12 ms)
      Î“ÃªÃœ should reject webhook with invalid signature (12 ms)
    Idempotency Key Handling
      Î“ÃªÃœ should accept first request with idempotency key (12 ms)
      Î“ÃªÃœ should reject duplicate request with same idempotency key (19 ms)
      Î“ÃªÃœ should require idempotency key (11 ms)
    Stripe Connect Account Flows
      Î“ÃªÃœ should create onboarding link (19 ms)
      Î“ÃªÃœ should get connect account status (23 ms)
      Î“ÃªÃœ should require authentication for connect endpoints (10 ms)
      Î“ÃªÃœ should show pending requirements (12 ms)
    Payment Error Handling
      Î“ÃªÃœ should handle card errors (19 ms)
      Î“ÃªÃœ should handle API errors (12 ms)
      Î“ÃªÃœ should handle rate limiting (13 ms)
    SCA (3D Secure) Flows
      Î“ÃªÃœ should return requires_action for 3DS (27 ms)
      Î“ÃªÃœ should succeed without 3DS when not required (11 ms)

  console.error
    An update to AuthProvider inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11801:19
      at runWithFiberInDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:1574:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11800:9)
      at scheduleUpdateOnFiber (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:10326:9)
      at dispatchSetStateInternal (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4148:13)
      at dispatchSetState (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4107:7)
      at providers/auth-provider.tsx:447:9
      at Object.<anonymous> (__tests__/integration/auth-persistence.test.tsx:334:12)

  console.error
    [AuthProvider] Error setting session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at providers/auth-provider.tsx:124:15

PASS __tests__/integration/websocket-bounty-updates.test.ts
  WebSocket Bounty Updates
    Real-time Status Updates
      Î“ÃªÃœ should subscribe to bounty.status events (375 ms)
      Î“ÃªÃœ should update bounty status when WebSocket event is received (144 ms)
      Î“ÃªÃœ should handle invalid WebSocket events gracefully (85 ms)
    Optimistic Updates
      Î“ÃªÃœ should optimistically update UI before API call (96 ms)
      Î“ÃªÃœ should rollback optimistic update on API failure (84 ms)
      Î“ÃªÃœ should not perform optimistic updates when disabled (102 ms)
    Multi-client Synchronization
      Î“Â£Ã„ todo should synchronize status updates across multiple hook instances
    Connection Management
      Î“ÃªÃœ should handle WebSocket send failures gracefully (69 ms)
      Î“ÃªÃœ should not send WebSocket events when disconnected (80 ms)
      Î“Â£Ã„ todo should publish WebSocket events when updating status
    Auto-refresh on Reconnection
      Î“ÃªÃœ should refresh bounties when WebSocket reconnects (125 ms)
    Add and Remove Bounties
      Î“ÃªÃœ should add a bounty to the local state (88 ms)
      Î“ÃªÃœ should remove a bounty from the local state (116 ms)
      Î“ÃªÃœ should remove a bounty with string id (74 ms)

  console.error
    [AuthProvider] Error setting session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at fetchSession (providers/auth-provider.tsx:244:13)

  console.error
    [AuthProvider] Error setting session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at providers/auth-provider.tsx:124:15

  console.error
    [AuthProvider] Error setting session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at fetchSession (providers/auth-provider.tsx:244:13)

  console.error
    [AuthProvider] Token refresh failed: { message: 'Invalid refresh token', status: 401 }

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at providers/auth-provider.tsx:91:11

  console.error
    [AuthProvider] Error clearing session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at providers/auth-provider.tsx:111:15

  console.error
    [AuthProvider] Error setting session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at fetchSession (providers/auth-provider.tsx:244:13)

  console.error
    [AuthProvider] Token refresh failed: { message: 'Refresh token expired', status: 401 }

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at providers/auth-provider.tsx:91:11

  console.error
    [AuthProvider] Error clearing session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at providers/auth-provider.tsx:111:15

PASS __tests__/integration/api/payment-flows.test.ts
  Payment Endpoints Integration Tests
    POST /api/payments/create-intent
      Î“ÃªÃœ should create payment intent with valid data (284 ms)
      Î“ÃªÃœ should reject unauthenticated requests (34 ms)
      Î“ÃªÃœ should reject amount below minimum (29 ms)
      Î“ÃªÃœ should handle Stripe errors gracefully (28 ms)
    POST /api/payments/confirm
      Î“ÃªÃœ should confirm payment intent (34 ms)
      Î“ÃªÃœ should require payment intent ID (17 ms)
      Î“ÃªÃœ should handle card declined errors (63 ms)
    POST /api/wallet/deposit
      Î“ÃªÃœ should create deposit transaction (19 ms)
      Î“ÃªÃœ should validate amount (15 ms)
      Î“ÃªÃœ should require payment intent ID (20 ms)
      Î“ÃªÃœ should verify payment is completed (13 ms)
    POST /api/wallet/withdraw
      Î“ÃªÃœ should create withdrawal transaction (15 ms)
      Î“ÃªÃœ should check sufficient balance (12 ms)
      Î“ÃªÃœ should require destination (14 ms)
    POST /api/escrow/create
      Î“ÃªÃœ should create escrow transaction (31 ms)
      Î“ÃªÃœ should require bounty ID (14 ms)
    POST /api/escrow/release
      Î“ÃªÃœ should release escrow to hunter with platform fee (37 ms)
      Î“ÃªÃœ should require hunter ID (14 ms)
    POST /api/refund
      Î“ÃªÃœ should process refund (18 ms)
      Î“ÃªÃœ should require payment intent ID (21 ms)
    GET /api/wallet/balance
      Î“ÃªÃœ should return wallet balance (13 ms)
      Î“ÃªÃœ should require authentication (13 ms)
    GET /api/payment-methods
      Î“ÃªÃœ should list payment methods (15 ms)
    Error handling scenarios
      Î“ÃªÃœ should handle rate limit errors (14 ms)
      Î“ÃªÃœ should handle network timeouts (10 ms)

  console.error
    [AuthProvider] Error clearing session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at fetchSession (providers/auth-provider.tsx:268:13)

  console.error
    An update to AuthProvider inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11801:19
      at runWithFiberInDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:1574:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11800:9)
      at scheduleUpdateOnFiber (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:10326:9)
      at dispatchSetStateInternal (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4148:13)
      at dispatchSetState (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4107:7)
      at providers/auth-provider.tsx:305:7
      at Object.<anonymous> (__tests__/integration/auth-persistence.test.tsx:490:15)

  console.error
    [AuthProvider] Error syncing session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at providers/auth-provider.tsx:317:11
      at Object.<anonymous> (__tests__/integration/auth-persistence.test.tsx:490:9)

  console.error
    An update to AuthProvider inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11801:19
      at runWithFiberInDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:1574:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11800:9)
      at scheduleUpdateOnFiber (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:10326:9)
      at dispatchSetStateInternal (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4148:13)
      at dispatchSetState (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4107:7)
      at providers/auth-provider.tsx:327:7
      at Object.<anonymous> (__tests__/integration/auth-persistence.test.tsx:490:9)

  console.error
    [AuthProvider] Error clearing session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at fetchSession (providers/auth-provider.tsx:268:13)

  console.error
    An update to AuthProvider inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11801:19
      at runWithFiberInDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:1574:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11800:9)
      at scheduleUpdateOnFiber (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:10326:9)
      at dispatchSetStateInternal (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4148:13)
      at dispatchSetState (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4107:7)
      at providers/auth-provider.tsx:305:7
      at Object.<anonymous> (__tests__/integration/auth-persistence.test.tsx:542:15)

  console.error
    [AuthProvider] Error syncing session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at providers/auth-provider.tsx:317:11
      at Object.<anonymous> (__tests__/integration/auth-persistence.test.tsx:542:9)

  console.error
    An update to AuthProvider inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11801:19
      at runWithFiberInDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:1574:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11800:9)
      at scheduleUpdateOnFiber (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:10326:9)
      at dispatchSetStateInternal (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4148:13)
      at dispatchSetState (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4107:7)
      at providers/auth-provider.tsx:327:7
      at Object.<anonymous> (__tests__/integration/auth-persistence.test.tsx:542:9)

  console.error
    [AuthProvider] Error clearing session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at fetchSession (providers/auth-provider.tsx:268:13)

  console.error
    An update to AuthProvider inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11801:19
      at runWithFiberInDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:1574:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11800:9)
      at scheduleUpdateOnFiber (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:10326:9)
      at dispatchSetStateInternal (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4148:13)
      at dispatchSetState (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4107:7)
      at providers/auth-provider.tsx:305:7
      at Object.<anonymous> (__tests__/integration/auth-persistence.test.tsx:591:15)

  console.error
    [AuthProvider] Error syncing session in profile service: Error: Failed to fetch profile
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\integration\auth-persistence.test.tsx:263:9)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at reportError (providers/auth-provider.tsx:50:30)
      at providers/auth-provider.tsx:317:11
      at Object.<anonymous> (__tests__/integration/auth-persistence.test.tsx:591:9)

  console.error
    An update to AuthProvider inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11801:19
      at runWithFiberInDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:1574:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:11800:9)
      at scheduleUpdateOnFiber (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:10326:9)
      at dispatchSetStateInternal (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4148:13)
      at dispatchSetState (node_modules/react-test-renderer/cjs/react-test-renderer.development.js:4107:7)
      at providers/auth-provider.tsx:327:7
      at Object.<anonymous> (__tests__/integration/auth-persistence.test.tsx:591:9)

PASS __tests__/integration/auth-persistence.test.tsx
  Authentication State Persistence
    Session Restoration on App Restart
      Î“ÃªÃœ should restore valid session from storage (94 ms)
      Î“ÃªÃœ should clean up subscription on unmount (11 ms)
      Î“ÃªÃœ should handle missing session gracefully (7 ms)
      Î“ÃªÃœ should handle corrupted session data (273 ms)
    Profile Loading Race Condition
      Î“ÃªÃœ should wait for profile to load before setting isLoading to false (14 ms)
      Î“ÃªÃœ should handle profile fetch failure gracefully (92 ms)
    Automatic Token Refresh
      Î“ÃªÃœ should schedule token refresh before expiration (162 ms)
      Î“ÃªÃœ should refresh immediately if token is already expired (77 ms)
      Î“ÃªÃœ should handle refresh failure gracefully (81 ms)
    Session Expiration Handling
      Î“ÃªÃœ should clear session when refresh fails (93 ms)
      Î“ÃªÃœ should trigger SIGNED_OUT event on token expiration (146 ms)
    Auth State Change Events
      Î“ÃªÃœ should handle SIGNED_IN event (110 ms)
      Î“ÃªÃœ should handle TOKEN_REFRESHED event (142 ms)

  console.error
    [Performance] No metric found with name: non-existent

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at PerformanceMonitor.end (lib/utils/performance-monitor.tsx:57:15)
      at Object.<anonymous> (__tests__/unit/utils/performance-monitor.test.ts:88:43)

PASS __tests__/unit/utils/performance-monitor.test.ts
  PerformanceMonitor
    start and end
      Î“ÃªÃœ should start tracking a metric (3 ms)
      Î“ÃªÃœ should end tracking a metric and calculate duration (3 ms)
      Î“ÃªÃœ should return null when ending non-existent metric (125 ms)
      Î“ÃªÃœ should log warning for slow operations (2 ms)
      Î“ÃªÃœ should include metadata in metric (1 ms)
      Î“ÃªÃœ should merge additional metadata when ending (1 ms)
    setEnabled
      Î“ÃªÃœ should not track metrics when disabled (1 ms)
      Î“ÃªÃœ should track metrics when enabled (1 ms)
    getAllMetrics
      Î“ÃªÃœ should return all tracked metrics (1 ms)
      Î“ÃªÃœ should return empty array when no metrics tracked (1 ms)
    clear
      Î“ÃªÃœ should remove all metrics (1 ms)
    getSummary
      Î“ÃªÃœ should return summary statistics (6 ms)
      Î“ÃªÃœ should handle empty metrics (3 ms)
  React hooks and HOCs
    Î“ÃªÃœ should export useRenderPerformance function (1 ms)
    Î“ÃªÃœ should export withScreenPerformance function (1 ms)
  trackAsyncPerformance
    Î“ÃªÃœ should track successful async operations (36 ms)
    Î“ÃªÃœ should track failed async operations (42 ms)
    Î“ÃªÃœ should include custom metadata (17 ms)
    Î“ÃªÃœ should pass arguments to wrapped function (1 ms)
  logMemoryUsage
    Î“ÃªÃœ should log memory usage when available (2 ms)
    Î“ÃªÃœ should handle missing performance.memory gracefully (1 ms)
    Î“ÃªÃœ should format memory values correctly (1 ms)

  console.error
    [ERROR] Background cache update failed {
      key: 'conversations_list',
      error: {
        name: 'Error',
        message: 'Failed to fetch',
        stack: 'Error: Failed to fetch\n' +
          '    at Object.<anonymous> (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\__tests__\\unit\\hooks\\useConversations.test.ts:57:23)\n' +
          '    at Promise.then.completed (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\node_modules\\jest-circus\\build\\utils.js:298:28)\n' +
          '    at new Promise (<anonymous>)\n' +
          '    at callAsyncCircusFn (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\node_modules\\jest-circus\\build\\utils.js:231:10)\n' +
          '    at _callCircusTest (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\node_modules\\jest-circus\\build\\run.js:316:40)\n' +
          '    at _runTest (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\node_modules\\jest-circus\\build\\run.js:252:3)\n' +
          '    at _runTestsForDescribeBlock (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\node_modules\\jest-circus\\build\\run.js:126:9)\n' +
          '    at _runTestsForDescribeBlock (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\node_modules\\jest-circus\\build\\run.js:121:9)\n' +
          '    at run (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\node_modules\\jest-circus\\build\\run.js:71:3)\n' +
          '    at runAndTransformResultsToJestFormat (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n' +
          '    at jestAdapter (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n' +
          '    at runTestInternal (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n' +
          '    at runTest (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n' +
          '    at Object.worker (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\node_modules\\jest-runner\\build\\testWorker.js:106:12)'
      }
    }

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at ErrorLogger.log (lib/utils/error-logger.ts:149:17)
      at ErrorLogger.error (lib/utils/error-logger.ts:165:10)
      at lib/services/cached-data-service.ts:190:22

PASS __tests__/unit/hooks/useConversations.test.ts
  useConversations
    Î“ÃªÃœ should set loading to false when no valid user (71 ms)
    Î“ÃªÃœ should fetch conversations when valid user exists (119 ms)
    Î“ÃªÃœ should handle fetch errors gracefully (365 ms)

PASS __tests__/components/offline-mode-banner.test.tsx
  OfflineModeBanner
    Î“ÃªÃœ should not render when online with no queued items (76 ms)
    Î“ÃªÃœ should render offline banner when offline (11 ms)
    Î“ÃªÃœ should show queued items count when offline (7 ms)
    Î“ÃªÃœ should show syncing status when online with queued items (26 ms)
    Î“ÃªÃœ should call checkConnection when refresh button is pressed (8 ms)
  CompactOfflineBanner
    Î“ÃªÃœ should not render when online with no queued items (6 ms)
    Î“ÃªÃœ should render offline text when offline (5 ms)
    Î“ÃªÃœ should show syncing count when online with queued items (6 ms)

PASS __tests__/unit/utils/date-utils.test.ts
  Date Utils
    formatDate
      Î“ÃªÃœ should format today's date with time (7 ms)
      Î“ÃªÃœ should format yesterday's date with time (2 ms)
      Î“ÃªÃœ should format older dates with full date (13 ms)
    formatRelativeTime
      Î“ÃªÃœ should format a recent date as relative time (20 ms)
      Î“ÃªÃœ should format a future date with "in" (1 ms)
      Î“ÃªÃœ should format a date from several days ago (1 ms)
    formatDateForGrouping
      Î“ÃªÃœ should return "Today" for today's date (2 ms)
      Î“ÃªÃœ should return "Yesterday" for yesterday's date (1 ms)
      Î“ÃªÃœ should return full formatted date for older dates (2 ms)
    formatTime
      Î“ÃªÃœ should format time in 12-hour format (1 ms)
      Î“ÃªÃœ should format morning time correctly
      Î“ÃªÃœ should format midnight correctly
      Î“ÃªÃœ should format noon correctly

PASS __tests__/unit/services/auth-service.test.ts
  Auth Service
    resendVerification
      Î“ÃªÃœ should successfully resend verification email (6 ms)
      Î“ÃªÃœ should handle lowercase and trim email (1 ms)
      Î“ÃªÃœ should handle resend error (2 ms)
      Î“ÃªÃœ should handle unexpected errors (1 ms)
    checkEmailVerified
      Î“ÃªÃœ should return true when email is verified (51 ms)
      Î“ÃªÃœ should return true when confirmed_at is set (1 ms)
      Î“ÃªÃœ should return false when email is not verified (3 ms)
      Î“ÃªÃœ should return false when no session exists (1 ms)
      Î“ÃªÃœ should handle errors gracefully (1 ms)
    requestPasswordReset
      Î“ÃªÃœ should successfully request password reset (2 ms)
      Î“ÃªÃœ should normalize email to lowercase (2 ms)
      Î“ÃªÃœ should return error for invalid email format (2 ms)
      Î“ÃªÃœ should handle rate limiting (1 ms)
      Î“ÃªÃœ should return success even for non-existent email (security) (2 ms)
      Î“ÃªÃœ should use custom redirect URL if provided (1 ms)
    updatePassword
      Î“ÃªÃœ should successfully update password (2 ms)
      Î“ÃªÃœ should fail if password validation fails (1 ms)
      Î“ÃªÃœ should handle expired token error (1 ms)
      Î“ÃªÃœ should handle session expired error (1 ms)
      Î“ÃªÃœ should handle same password error (1 ms)
      Î“ÃªÃœ should handle unexpected errors (1 ms)
    verifyResetToken
      Î“ÃªÃœ should successfully verify valid token (2 ms)
      Î“ÃªÃœ should fail for empty token (1 ms)
      Î“ÃªÃœ should handle expired token (1 ms)
      Î“ÃªÃœ should handle invalid token (1 ms)
      Î“ÃªÃœ should fail when no session is returned
      Î“ÃªÃœ should use correct token type (3 ms)
    isInRecoveryMode
      Î“ÃªÃœ should return false when no session exists (1 ms)
      Î“ÃªÃœ should return true when in recovery mode (1 ms)
      Î“ÃªÃœ should return true when using OTP method (1 ms)
      Î“ÃªÃœ should return false for normal password login
      Î“ÃªÃœ should handle errors gracefully (1 ms)

PASS __tests__/components/sync-status-indicator.test.tsx
  SyncStatusIndicator
    Î“ÃªÃœ should not render when online with no pending or failed items (39 ms)
    Î“ÃªÃœ should show syncing state when online with pending items (19 ms)
    Î“ÃªÃœ should show error state when there are failed items (62 ms)
    Î“ÃªÃœ should show pending state when offline with items (5 ms)
    Î“ÃªÃœ should render without details when detailed=false (7 ms)
  SyncStatusBadge
    Î“ÃªÃœ should not render when no items to sync (3 ms)
    Î“ÃªÃœ should show failed count when there are failed items (4 ms)
    Î“ÃªÃœ should show pending count when online with pending items (3 ms)

PASS __tests__/unit/services/bounty-service-spam.test.ts
  Bounty Service - Spam Prevention
    Rate Limiting
      Î“ÃªÃœ should block creation when user exceeds daily limit (10 bounties) (148 ms)
      Î“ÃªÃœ should allow creation when user is under daily limit (7 ms)
      Î“ÃªÃœ should gracefully proceed when rate limit check fails (15 ms)
    Duplicate Detection
      Î“ÃªÃœ should block creation for exact duplicate titles (3 ms)
      Î“ÃªÃœ should block creation for case-insensitive duplicate titles (2 ms)
      Î“ÃªÃœ should allow creation for different titles (4 ms)
      Î“ÃªÃœ should gracefully proceed when duplicate check fails (3 ms)
      Î“ÃªÃœ should allow creation when no recent bounties exist (5 ms)
    Edge Cases
      Î“ÃªÃœ should skip spam checks when poster_id is not provided (3 ms)
      Î“ÃªÃœ should handle trimmed and whitespace titles correctly (2 ms)

PASS __tests__/components/offline-status-badge.test.tsx
  OfflineStatusBadge Component
    Î“ÃªÃœ should render null when online with no pending or failed items (9 ms)
    Î“ÃªÃœ should display pending count when offline (39 ms)
    Î“ÃªÃœ should display syncing count when online with pending items (7 ms)
    Î“ÃªÃœ should display failed count when there are failures (4 ms)
    Î“ÃªÃœ should prioritize showing failed count over pending (7 ms)
    Î“ÃªÃœ should render with onPress handler (4 ms)
    Î“ÃªÃœ should handle zero failed but some pending items (4 ms)

PASS __tests__/unit/utils/error-messages.test.ts
  Error Messages
    getUserFriendlyError
      Network errors
        Î“ÃªÃœ should handle network request failed errors (3 ms)
        Î“ÃªÃœ should handle ECONNREFUSED errors (1 ms)
        Î“ÃªÃœ should handle Failed to fetch errors
        Î“ÃªÃœ should handle timeout errors (2 ms)
      Navigation context errors
        Î“ÃªÃœ should handle navigation context not found error (1 ms)
        Î“ÃªÃœ should handle NavigationContent error
      Authentication errors
        Î“ÃªÃœ should handle 401 status errors (1 ms)
        Î“ÃªÃœ should handle Unauthorized message (1 ms)
      Authorization errors
        Î“ÃªÃœ should handle 403 status errors (2 ms)
        Î“ÃªÃœ should handle Forbidden message (1 ms)
      Rate limiting errors
        Î“ÃªÃœ should handle 429 status errors (18 ms)
        Î“ÃªÃœ should handle rate limit message (1 ms)
      Supabase errors
        Î“ÃªÃœ should handle JWT expired errors (1 ms)
        Î“ÃªÃœ should handle row-level security errors
        Î“ÃªÃœ should handle duplicate key errors (23505)
        Î“ÃªÃœ should handle PGRST116 not found errors
      Stripe errors
        Î“ÃªÃœ should handle card_error type (1 ms)
        Î“ÃªÃœ should handle authentication_required
        Î“ÃªÃœ should handle rate_limit_error type
        Î“ÃªÃœ should handle api_error type
      Server errors
        Î“ÃªÃœ should handle 500 status errors (1 ms)
        Î“ÃªÃœ should handle Internal Server Error message (1 ms)
      Unknown errors
        Î“ÃªÃœ should handle unknown errors with safe message (4 ms)
        Î“ÃªÃœ should handle null/undefined errors (4 ms)
    sanitizeErrorMessage
      Î“ÃªÃœ should sanitize navigation context errors (1 ms)
      Î“ÃªÃœ should sanitize SQL-related errors (1 ms)
      Î“ÃªÃœ should sanitize stack trace patterns (1 ms)
      Î“ÃªÃœ should sanitize Supabase references (2 ms)
      Î“ÃªÃœ should sanitize Stripe key patterns (3 ms)
      Î“ÃªÃœ should preserve safe messages (1 ms)
    getValidationError
      Î“ÃªÃœ should format required field errors (1 ms)
      Î“ÃªÃœ should format email validation errors
      Î“ÃªÃœ should format password validation errors (2 ms)
      Î“ÃªÃœ should format min length errors (1 ms)
      Î“ÃªÃœ should format max length errors (1 ms)
    getPaymentErrorMessage
      Î“ÃªÃœ should return correct message for card_declined (1 ms)
      Î“ÃªÃœ should return correct message for insufficient_funds (1 ms)
      Î“ÃªÃœ should return correct message for expired_card
      Î“ÃªÃœ should return correct message for decline_code (1 ms)
      Î“ÃªÃœ should return generic message for unknown codes (1 ms)
      Î“ÃªÃœ should return generic message for null error

PASS __tests__/unit/lib/auth-session-storage.test.ts
  Auth Session Storage - Remember Me Preference
    setRememberMePreference
      Î“ÃªÃœ should cache preference in memory immediately before SecureStore write (5 ms)
      Î“ÃªÃœ should cache false preference correctly (2 ms)
      Î“ÃªÃœ should handle SecureStore write failure gracefully (27 ms)
    getRememberMePreference
      Î“ÃªÃœ should return cached value without calling SecureStore after initial set (3 ms)
      Î“ÃªÃœ should read from SecureStore on cache miss and populate cache (1 ms)
      Î“ÃªÃœ should return false by default if no preference is set (1 ms)
      Î“ÃªÃœ should handle SecureStore read failure gracefully (1 ms)
    clearRememberMePreference
      Î“ÃªÃœ should clear both memory cache and SecureStore (1 ms)
      Î“ÃªÃœ should handle SecureStore delete failure gracefully (1 ms)
    clearAllSessionData
      Î“ÃªÃœ should clear remember me preference cache (14 ms)
    Race Condition Scenarios
      Î“ÃªÃœ should handle rapid set followed by get without race condition (1 ms)
      Î“ÃªÃœ should handle multiple rapid sets correctly (1 ms)
      Î“ÃªÃœ should handle concurrent set and get operations (2 ms)
    Edge Cases
      Î“ÃªÃœ should handle null cache correctly (1 ms)
      Î“ÃªÃœ should handle switching between true and false (1 ms)
      Î“ÃªÃœ should persist cache across multiple get calls (6 ms)

PASS __tests__/unit/services/cancellation-service.test.ts
  CancellationService
    calculateRecommendedRefund
      Î“ÃªÃœ should return 100% refund for open bounties (3 ms)
      Î“ÃªÃœ should return 100% refund for open bounties even if hunter accepted (1 ms)
      Î“ÃªÃœ should return 50% refund for in_progress bounties with accepted hunter (1 ms)
      Î“ÃªÃœ should return 100% refund for in_progress bounties without accepted hunter (1 ms)
      Î“ÃªÃœ should return 0% refund for completed bounties
      Î“ÃªÃœ should return 50% refund for other statuses
    Cancellation workflow
      Î“ÃªÃœ should create cancellation request with correct data structure (1 ms)
      Î“ÃªÃœ should accept cancellation and update status (1 ms)
      Î“ÃªÃœ should reject cancellation and revert bounty status
      Î“ÃªÃœ should get cancellation by bounty ID (1 ms)
      Î“ÃªÃœ should update user stats after cancellation (1 ms)

  console.error
    [DataExport] File write failed: Error: File write failed
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\data-export.test.ts:271:55)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at exportUserData (lib/services/data-export-service.ts:355:15)
      at Object.<anonymous> (__tests__/unit/services/data-export.test.ts:273:22)

  console.error
    [DataExport] Share error: Error: Share failed
        at Object.<anonymous> (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\__tests__\unit\services\data-export.test.ts:358:44)
        at Promise.then.completed (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (C:\Users\Kodak\Desktop\BOUNTYv0\Code Files\Bounty-production\node_modules\jest-runner\build\testWorker.js:106:12)

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at exportAndShareUserData (lib/services/data-export-service.ts:412:13)
      at Object.<anonymous> (__tests__/unit/services/data-export.test.ts:360:22)

PASS __tests__/unit/services/data-export.test.ts
  Data Export Service
    exportUserData
      Î“ÃªÃœ should return error if user is not authenticated (13 ms)
      Î“ÃªÃœ should return error if session user does not match requested user (1 ms)
      Î“ÃªÃœ should collect user data from multiple tables (5 ms)
      Î“ÃªÃœ should export data structure with all required sections (43 ms)
      Î“ÃªÃœ should not include userId in filename for privacy protection (6 ms)
      Î“ÃªÃœ should still succeed if file write fails but return data (95 ms)
    exportAndShareUserData
      Î“ÃªÃœ should share file if sharing is available (20 ms)
      Î“ÃªÃœ should handle sharing not available on device (3 ms)
      Î“ÃªÃœ should return error if data export fails (9 ms)
      Î“ÃªÃœ should handle sharing errors gracefully (15 ms)
    GDPR Compliance
      Î“ÃªÃœ should export data in machine-readable format (JSON) (4 ms)
      Î“ÃªÃœ should include export timestamp for audit purposes (4 ms)

PASS __tests__/unit/services/search-service.test.ts
  Search Service
    getAutocompleteSuggestions
      Î“ÃªÃœ should return empty array for empty query (6 ms)
      Î“ÃªÃœ should return empty array for whitespace query (1 ms)
      Î“ÃªÃœ should return bounty suggestions when bounties match (2 ms)
      Î“ÃªÃœ should return user suggestions when users match (1 ms)
      Î“ÃªÃœ should return skill suggestions for matching skills (1 ms)
      Î“ÃªÃœ should limit results to specified limit (1 ms)
    Saved Searches
      saveSearch
        Î“ÃªÃœ should save a new search (3 ms)
        Î“ÃªÃœ should append to existing searches (2 ms)
      getSavedSearches
        Î“ÃªÃœ should return empty array when no saved searches (1 ms)
        Î“ÃªÃœ should return saved searches (1 ms)
      deleteSavedSearch
        Î“ÃªÃœ should delete a saved search (2 ms)
      toggleSearchAlerts
        Î“ÃªÃœ should toggle alerts on a saved search (3 ms)
        Î“ÃªÃœ should return false for non-existent search (1 ms)
    Filter Persistence
      saveLastFilters
        Î“ÃªÃœ should save filters to AsyncStorage (2 ms)
      getLastFilters
        Î“ÃªÃœ should return null when no saved filters (1 ms)
        Î“ÃªÃœ should return saved filters (3 ms)
    getTrendingBounties
      Î“ÃªÃœ should return empty array when no bounties (3 ms)
    calculateTrendingScores
      Î“ÃªÃœ should calculate trending scores for bounties (6 ms)
      Î“ÃªÃœ should sort by trending score descending (2 ms)
      Î“ÃªÃœ should limit results to specified count (6 ms)

PASS __tests__/unit/services/receipt-service.test.ts
  ReceiptService
    generateReceiptText
      Î“ÃªÃœ should generate a text receipt with all required fields (138 ms)
      Î“ÃªÃœ should handle negative amounts correctly (8 ms)
      Î“ÃªÃœ should handle optional fields gracefully (3 ms)
      Î“ÃªÃœ should include escrow status when present (3 ms)
      Î“ÃªÃœ should include dispute status when not "none" (2 ms)
      Î“ÃªÃœ should not include dispute status when "none" (2 ms)
      Î“ÃªÃœ should include counterparty when present (3 ms)
    getTypeLabel
      Î“ÃªÃœ should return correct labels for all transaction types (18 ms)
      Î“ÃªÃœ should handle unknown transaction types gracefully (2 ms)
    generateReceiptHTML
      Î“ÃªÃœ should generate valid HTML receipt (3 ms)
      Î“ÃªÃœ should use green color for positive amounts (2 ms)
      Î“ÃªÃœ should use red color for negative amounts (2 ms)
      Î“ÃªÃœ should include optional fields in HTML when present (2 ms)
    shareReceipt
      Î“ÃªÃœ should successfully share receipt when sharing is available (4 ms)
      Î“ÃªÃœ should return false when sharing is not available (2 ms)
      Î“ÃªÃœ should handle sharing errors gracefully (38 ms)
      Î“ÃªÃœ should handle Sharing.isAvailableAsync errors (5 ms)
    edge cases
      Î“ÃªÃœ should handle zero amount (2 ms)
      Î“ÃªÃœ should handle very large amounts (3 ms)
      Î“ÃªÃœ should format dates consistently (2 ms)
      Î“ÃªÃœ should handle special characters in transaction details (2 ms)

PASS __tests__/unit/utils/sanitization.test.ts
  sanitization utilities
    sanitizeText
      Î“ÃªÃœ should remove HTML tags (2 ms)
      Î“ÃªÃœ should escape HTML entities (64 ms)
      Î“ÃªÃœ should trim whitespace (5 ms)
      Î“ÃªÃœ should handle null and undefined (1 ms)
      Î“ÃªÃœ should handle empty string (1 ms)
    sanitizeEmail
      Î“ÃªÃœ should normalize valid email (2 ms)
      Î“ÃªÃœ should throw error for invalid email (72 ms)
      Î“ÃªÃœ should handle null and undefined (1 ms)
    sanitizeURL
      Î“ÃªÃœ should accept valid HTTPS URL (1 ms)
      Î“ÃªÃœ should accept valid HTTP URL
      Î“ÃªÃœ should throw error for URL without protocol (2 ms)
      Î“ÃªÃœ should throw error for invalid protocol (2 ms)
      Î“ÃªÃœ should handle null and undefined (2 ms)
    sanitizeNumber
      Î“ÃªÃœ should accept valid number (2 ms)
      Î“ÃªÃœ should accept decimal numbers (10 ms)
      Î“ÃªÃœ should throw error for non-numeric input (11 ms)
      Î“ÃªÃœ should throw error for NaN (1 ms)
      Î“ÃªÃœ should throw error for Infinity (2 ms)
      Î“ÃªÃœ should throw error for null and undefined (5 ms)
      Î“ÃªÃœ should accept negative numbers (1 ms)
      Î“ÃªÃœ should reject numbers with plus sign for consistency (1 ms)
    sanitizePositiveNumber
      Î“ÃªÃœ should accept positive numbers (2 ms)
      Î“ÃªÃœ should throw error for negative numbers (3 ms)
    sanitizeMessage
      Î“ÃªÃœ should sanitize valid message (1 ms)
      Î“ÃªÃœ should throw error for empty message (2 ms)
      Î“ÃªÃœ should throw error for null and undefined (4 ms)
      Î“ÃªÃœ should throw error for message too long (3 ms)
      Î“ÃªÃœ should accept message with max length (51 ms)
    sanitizeBountyInput
      Î“ÃªÃœ should sanitize valid bounty (2 ms)
      Î“ÃªÃœ should throw error for short title (6 ms)
      Î“ÃªÃœ should throw error for short description (3 ms)
      Î“ÃªÃœ should throw error for negative amount (1 ms)
      Î“ÃªÃœ should accept bounty without amount
      Î“ÃªÃœ should accept bounty without location (1 ms)
    sanitizeProfileInput
      Î“ÃªÃœ should sanitize valid profile (1 ms)
      Î“ÃªÃœ should throw error for display name too long (2 ms)
      Î“ÃªÃœ should throw error for bio too long (2 ms)
      Î“ÃªÃœ should throw error for invalid website URL (2 ms)
      Î“ÃªÃœ should accept profile with only some fields (1 ms)
      Î“ÃªÃœ should accept empty profile (2 ms)
    XSS prevention
      Î“ÃªÃœ should sanitize XSS payload: <script>alert("xss")</script> (6 ms)
      Î“ÃªÃœ should sanitize XSS payload: <img src=x onerror=alert("xss")> (2 ms)
      Î“ÃªÃœ should sanitize XSS payload: <svg/onload=alert("xss")> (2 ms)
      Î“ÃªÃœ should sanitize XSS payload: <iframe src="javascript:alert('xss')"> (2 ms)
      Î“ÃªÃœ should sanitize XSS payload: <body onload=alert("xss")> (25 ms)
      Î“ÃªÃœ should escape javascript: protocol (1 ms)

  console.error
    [ERROR] Error creating bounty (showing once until reload) {
      bounty: {
        title: 'Test bounty',
        description: 'Test description',
        amount: 50,
        is_for_honor: false,
        poster_id: 'user_123',
        status: 'open',
        location: '',
        timeline: '',
        skills_required: ''
      },
      error: {
        message: 'Rate limit exceeded: You can only create 10 bounties per day. Please try again tomorrow.',
        stack: 'Error: Rate limit exceeded: You can only create 10 bounties per day. Please try again tomorrow.\n' +
          '    at Object.create (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\lib\\services\\bounty-service.ts:677:19)\n' +
          '    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
          '    at Object.<anonymous> (C:\\Users\\Kodak\\Desktop\\BOUNTYv0\\Code Files\\Bounty-production\\__tests__\\integration\\bounty-creation.test.ts:179:7)'
      }
    }

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at ErrorLogger.log (lib/utils/error-logger.ts:149:17)
      at ErrorLogger.error (lib/utils/error-logger.ts:165:10)
      at logOnce (lib/services/bounty-service.ts:72:12)
      at Object.create (lib/services/bounty-service.ts:871:7)
      at Object.<anonymous> (__tests__/integration/bounty-creation.test.ts:179:7)

PASS __tests__/integration/bounty-creation.test.ts
  Bounty Creation Integration Tests
    Create Paid Bounty Flow
      Î“ÃªÃœ should successfully create a paid bounty through the service (6 ms)
      Î“ÃªÃœ should handle rate limit exceeded error (258 ms)
    Create Honor Bounty Flow
      Î“ÃªÃœ should successfully create an honor bounty through the service (3 ms)
    Bounty Creation Error Handling
      Î“ÃªÃœ should handle duplicate bounty detection (2 ms)

PASS __tests__/unit/services/notification-service.test.ts
  NotificationService
    getPermissionStatus
      Î“ÃªÃœ should return "granted" when permission is granted (4 ms)
      Î“ÃªÃœ should return "denied" when permission is denied (2 ms)
      Î“ÃªÃœ should return "undetermined" when permission is undetermined (2 ms)
      Î“ÃªÃœ should normalize unexpected status values to "undetermined" (1 ms)
      Î“ÃªÃœ should fallback to cached status when getPermissionsAsync fails (5 ms)
      Î“ÃªÃœ should return "undetermined" when both API and cache fail (3 ms)
      Î“ÃªÃœ should normalize cached status values (1 ms)
    getStoredPermissionStatus
      Î“ÃªÃœ should return cached "granted" status (2 ms)
      Î“ÃªÃœ should return cached "denied" status (1 ms)
      Î“ÃªÃœ should return cached "undetermined" status (1 ms)
      Î“ÃªÃœ should return null when no cached status exists (1 ms)
      Î“ÃªÃœ should return null when AsyncStorage fails (1 ms)
      Î“ÃªÃœ should normalize unexpected cached values to "undetermined" (1 ms)

  console.error
    Could not create admin notification: Notification table error

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at notifyAdminsOfReport (lib/services/report-service.ts:66:15)
      at Object.reportBounty (lib/services/report-service.ts:105:7)
      at Object.<anonymous> (__tests__/unit/services/report-service.test.ts:196:22)

PASS __tests__/e2e/payment-flow.test.ts
  Payment Flow E2E Tests
    Escrow Creation Flow
      Î“ÃªÃœ should create escrow when bounty is accepted (18 ms)
      Î“ÃªÃœ should store escrow reference in database (2 ms)
      Î“ÃªÃœ should prevent multiple escrows for same bounty (2 ms)
    Payment Release Flow
      Î“ÃªÃœ should release escrow when bounty is completed (1 ms)
      Î“ÃªÃœ should transfer funds to hunter on release (2 ms)
      Î“ÃªÃœ should update bounty status after release (1 ms)
      Î“ÃªÃœ should only allow poster to release payment (1 ms)
    Refund Flow
      Î“ÃªÃœ should refund escrow if bounty is canceled (1 ms)
      Î“ÃªÃœ should handle partial refunds for disputes (4 ms)
      Î“ÃªÃœ should return funds to poster on refund (1 ms)
      Î“ÃªÃœ should update bounty status after refund (1 ms)
    Complex Payment Scenarios
      Î“ÃªÃœ should handle bounty with milestone payments (2 ms)
      Î“ÃªÃœ should handle payment failures and retry logic (1 ms)
      Î“ÃªÃœ should handle escrow timeout scenarios (1 ms)
    Payment Security
      Î“ÃªÃœ should validate payment amount matches bounty amount
      Î“ÃªÃœ should prevent double-release of escrow (53 ms)
      Î“ÃªÃœ should log all payment operations for audit (3 ms)

  console.error
    Error submitting bounty report: { message: 'Database error' }

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at Object.reportBounty (lib/services/report-service.ts:100:17)
      at Object.<anonymous> (__tests__/unit/services/report-service.test.ts:334:22)

  console.error
    Error updating report status: { message: 'Update failed' }

    [0m [90m 357 |[39m       [36mreturn[39m[33m;[39m
     [90m 358 |[39m     }
    [31m[1m>[22m[39m[90m 359 |[39m     originalError([33m...[39margs)[33m;[39m
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 360 |[39m   }[33m,[39m
     [90m 361 |[39m   warn[33m:[39m jest[33m.[39mfn()[33m,[39m
     [90m 362 |[39m   log[33m:[39m jest[33m.[39mfn()[33m,[39m[0m

      at Object.error (jest.setup.js:359:5)
      at Object.updateReportStatus (lib/services/report-service.ts:257:17)
      at Object.<anonymous> (__tests__/unit/services/report-service.test.ts:375:22)

PASS __tests__/unit/services/report-service.test.ts
  Report Service
    REPORT_REASONS
      Î“ÃªÃœ should have correct report reason definitions (4 ms)
    Admin Notification Creation
      Î“ÃªÃœ should create admin notification when reporting a bounty (3 ms)
      Î“ÃªÃœ should create admin notification when reporting a user (2 ms)
      Î“ÃªÃœ should create admin notification when reporting a message (5 ms)
      Î“ÃªÃœ should set high priority for fraud reports (2 ms)
      Î“ÃªÃœ should set high priority for harassment reports (2 ms)
      Î“ÃªÃœ should set normal priority for spam reports (2 ms)
      Î“ÃªÃœ should not block report submission if notification creation fails (82 ms)
    Report Statistics Aggregation
      Î“ÃªÃœ should aggregate report statistics correctly (14 ms)
      Î“ÃªÃœ should handle database errors in statistics query (1 ms)
      Î“ÃªÃœ should return zero counts when no reports exist (3 ms)
      Î“ÃªÃœ should handle null counts gracefully (50 ms)
    Report Submission
      Î“ÃªÃœ should require authentication for reporting (1 ms)
      Î“ÃªÃœ should successfully submit a bounty report (2 ms)
      Î“ÃªÃœ should handle report submission errors (11 ms)
    Report Status Update
      Î“ÃªÃœ should successfully update report status (2 ms)
      Î“ÃªÃœ should include resolution notes when provided (4 ms)
      Î“ÃªÃœ should handle update errors (8 ms)

PASS __tests__/unit/hooks/use-attachment-upload.test.ts
  useAttachmentUpload
    Initialization
      Î“ÃªÃœ should initialize with default state (37 ms)
      Î“ÃªÃœ should accept custom options (5 ms)
    File Picker - Photos
      Î“ÃªÃœ should pick image from photo library (10 ms)
      Î“ÃªÃœ should handle permission denial for photo library (8 ms)
      Î“ÃªÃœ should handle user cancellation (47 ms)
    File Picker - Camera
      Î“ÃªÃœ should pick image from camera (7 ms)
      Î“ÃªÃœ should handle permission denial for camera (6 ms)
    File Picker - Documents
      Î“ÃªÃœ should pick document from file system (5 ms)
    File Validation
      Î“ÃªÃœ should reject files that exceed max size (16 ms)
      Î“ÃªÃœ should accept files within size limit (52 ms)
    Upload Retry Logic
      Î“ÃªÃœ should retry upload 3 times with exponential backoff on failure (16 ms)
      Î“ÃªÃœ should succeed on second retry attempt (6 ms)
      Î“ÃªÃœ should use exponential backoff delays (1s, 2s, 4s) (14 ms)
    Progress Tracking
      Î“ÃªÃœ should track upload progress (13 ms)
      Î“ÃªÃœ should reset progress after successful upload (5 ms)
    Error Handling
      Î“ÃªÃœ should call onError callback on upload failure (8 ms)
      Î“ÃªÃœ should show alert on upload failure after retries (6 ms)
      Î“ÃªÃœ should allow clearing error state (8 ms)
    State Management
      Î“ÃªÃœ should track isPicking state during file selection (5 ms)
      Î“ÃªÃœ should track isUploading state during upload (10 ms)
      Î“ÃªÃœ should store lastUploaded attachment (4 ms)
      Î“ÃªÃœ should reset all state (4 ms)

PASS __tests__/unit/services/error-handling.test.ts
  Error Handling Improvements
    NotificationService - getUnreadCount
      Î“ÃªÃœ should fall back to Supabase when API times out (4 ms)
      Î“ÃªÃœ should return cached count when both API and Supabase fail (3 ms)
      Î“ÃªÃœ should throttle error logging in development mode (7 ms)
    NotificationService - fetchNotifications
      Î“ÃªÃœ should prioritize Supabase over API in development (3 ms)
      Î“ÃªÃœ should return cached notifications when all sources fail (2 ms)

PASS __tests__/integration/api/auth-flow.test.ts
  Authentication Flow Tests
    Sign Up Flow
      Î“ÃªÃœ should successfully sign up a new user (3 ms)
      Î“ÃªÃœ should reject sign up with weak password (2 ms)
      Î“ÃªÃœ should reject sign up with invalid email (1 ms)
      Î“ÃªÃœ should reject sign up with existing email (1 ms)
    Sign In Flow
      Î“ÃªÃœ should successfully sign in with valid credentials (3 ms)
      Î“ÃªÃœ should reject sign in with incorrect password (1 ms)
      Î“ÃªÃœ should reject sign in with non-existent user (2 ms)
      Î“ÃªÃœ should block sign in for unverified email (1 ms)
    Token Refresh Flow
      Î“ÃªÃœ should successfully refresh expired token (2 ms)
      Î“ÃªÃœ should handle invalid refresh token (3 ms)
      Î“ÃªÃœ should automatically refresh before expiration (3 ms)
    Email Verification Flow
      Î“ÃªÃœ should resend verification email (2 ms)
      Î“ÃªÃœ should handle rate limiting on resend (10 ms)
      Î“ÃªÃœ should check email verification status (1 ms)
    Sign Out Flow
      Î“ÃªÃœ should successfully sign out (2 ms)
      Î“ÃªÃœ should clear session after sign out (1 ms)
    Session Management
      Î“ÃªÃœ should retrieve current session (21 ms)
      Î“ÃªÃœ should return null for no active session (1 ms)

PASS __tests__/unit/utils/password-validation.test.ts
  Password Validation
    isValidEmail
      Î“ÃªÃœ should return true for valid email addresses (7 ms)
      Î“ÃªÃœ should return false for invalid email addresses (2 ms)
      Î“ÃªÃœ should trim whitespace before validation
    EMAIL_REGEX
      Î“ÃªÃœ should be a valid regex pattern (2 ms)
    checkPasswordRequirements
      Î“ÃªÃœ should return all requirements as not met for empty password (2 ms)
      Î“ÃªÃœ should detect minimum length requirement (2 ms)
      Î“ÃªÃœ should detect uppercase requirement (2 ms)
      Î“ÃªÃœ should detect lowercase requirement (6 ms)
      Î“ÃªÃœ should detect number requirement (1 ms)
      Î“ÃªÃœ should detect special character requirement (4 ms)
    calculatePasswordStrength
      Î“ÃªÃœ should return very-weak for empty password (2 ms)
      Î“ÃªÃœ should return very-weak for simple password (2 ms)
      Î“ÃªÃœ should return strong for password meeting all requirements (2 ms)
      Î“ÃªÃœ should return very-strong for long complex password (4 ms)
      Î“ÃªÃœ should penalize common password patterns (3 ms)
      Î“ÃªÃœ should penalize repeating characters (1 ms)
      Î“ÃªÃœ should provide feedback for missing requirements (1 ms)
    validateNewPassword
      Î“ÃªÃœ should return error for empty password (1 ms)
      Î“ÃªÃœ should return error for short password (2 ms)
      Î“ÃªÃœ should return error for very long password (1 ms)
      Î“ÃªÃœ should return null for valid password (1 ms)
      Î“ÃªÃœ should return error for password missing requirements (2 ms)
    validatePasswordMatch
      Î“ÃªÃœ should return error for empty confirmation
      Î“ÃªÃœ should return error for mismatched passwords
      Î“ÃªÃœ should return null for matching passwords (1 ms)
    getStrengthColor
      Î“ÃªÃœ should return correct colors for each level (4 ms)
    getStrengthWidth
      Î“ÃªÃœ should return minimum 5% for score 0 (5 ms)
      Î“ÃªÃœ should return correct percentage for each score (1 ms)
    PASSWORD_REQUIREMENTS constant
      Î“ÃªÃœ should have correct default values (4 ms)

PASS __tests__/accessibility/bottom-nav.test.tsx
  BottomNav Accessibility
    Î“ÃªÃœ should import BottomNav component without errors (27 ms)
    WCAG 4.1.2 - Name, Role, Value
      Î“ÃªÃœ should verify accessibility props are implemented (2 ms)
      Î“ÃªÃœ should verify button role is used for nav items (1 ms)
      Î“ÃªÃœ should verify selection state is communicated (1 ms)
    WCAG 2.5.5 - Touch Target Size
      Î“ÃªÃœ should verify minimum touch target size implementation (1 ms)
      Î“ÃªÃœ should verify center button is larger for emphasis (2 ms)
    Navigation Features
      Î“ÃªÃœ should verify navigation screen types are defined (3 ms)
      Î“ÃªÃœ should verify admin button support (1 ms)
      Î“ÃªÃœ should verify haptic feedback implementation (2 ms)
    Visual Feedback
      Î“ÃªÃœ should verify animation implementation (4 ms)
      Î“ÃªÃœ should verify uses standardized animation duration (5 ms)
    Accessibility Constants
      Î“ÃªÃœ should use standardized sizing (1 ms)
      Î“ÃªÃœ should use standardized animations (2 ms)
    Icon Sizes
      Î“ÃªÃœ should verify icon size constants provide visual hierarchy (2 ms)

PASS __tests__/unit/utils/withTimeout.test.ts
  withTimeout
    Î“ÃªÃœ should resolve when promise completes before timeout (7 ms)
    Î“ÃªÃœ should reject with timeout error when promise takes too long (153 ms)
    Î“ÃªÃœ should propagate promise rejection (11 ms)
    Î“ÃªÃœ should handle different timeout values (84 ms)
    Î“ÃªÃœ should timeout correctly with 0ms timeout (44 ms)
    Î“ÃªÃœ should work with async functions (53 ms)
    Î“ÃªÃœ should work with fetch-like promises (1 ms)

PASS __tests__/unit/services/message-service.test.ts
  Message Service - Conversation Deduplication
    getOrCreateConversation
      Î“ÃªÃœ should use Supabase getOrCreateConversation for 1:1 chats to prevent duplicates (4 ms)
      Î“ÃªÃœ should return existing conversation when one already exists between users (2 ms)
      Î“ÃªÃœ should pass bountyId to supabase getOrCreateConversation (1 ms)
      Î“ÃªÃœ should fall back to local messaging when Supabase fails (2 ms)
      Î“ÃªÃœ should use local messaging for group conversations (more than 2 participants) (2 ms)

PASS __tests__/unit/services/stale-bounty-service.test.ts
  StaleBountyService
    isBountyStale
      Î“ÃªÃœ should correctly identify stale bounties (2 ms)
    getStaleReason
      Î“ÃªÃœ should return correct reason for hunter_deleted
      Î“ÃªÃœ should return empty string for non-stale bounties
      Î“ÃªÃœ should return default message for unknown reasons (28 ms)
  Stale Bounty Detection Flow
    Î“ÃªÃœ should mark bounties as stale when hunter is deleted (1 ms)

PASS __tests__/unit/services/portfolio-service.test.ts
  portfolio-service
    MAX_PORTFOLIO_ITEMS
      Î“ÃªÃœ should be set to 10 (11 ms)
    generateVideoThumbnail
      Î“ÃªÃœ should generate a thumbnail for a video (5 ms)
      Î“ÃªÃœ should use custom time parameter (2 ms)
      Î“ÃªÃœ should return undefined on error (3 ms)
    portfolioService.getItems
      Î“ÃªÃœ should return empty array for user with no items (3 ms)
      Î“ÃªÃœ should return items sorted by createdAt descending (3 ms)
    portfolioService.addItem
      Î“ÃªÃœ should add an item and return it with id and createdAt (10 ms)
    portfolioService.getItemCount
      Î“ÃªÃœ should return 0 for user with no items (2 ms)
      Î“ÃªÃœ should return correct count for user with items (4 ms)
    portfolioService.canAddItem
      Î“ÃªÃœ should return true when user has fewer than MAX_PORTFOLIO_ITEMS (4 ms)
      Î“ÃªÃœ should return false when user has MAX_PORTFOLIO_ITEMS (3 ms)
    portfolioService.reorderItems
      Î“ÃªÃœ should reorder items according to provided order (4 ms)

PASS __tests__/integration/api/bounty-service.test.ts
  Bounty Service Integration Tests
    acceptBounty Flow
      Î“ÃªÃœ should successfully accept an open bounty with payment (20 ms)
      Î“ÃªÃœ should accept honor bounty without payment (8 ms)
      Î“ÃªÃœ should reject accepting non-open bounty (3 ms)
      Î“ÃªÃœ should handle non-existent bounty (2 ms)
      Î“ÃªÃœ should handle database errors gracefully (87 ms)
      Î“ÃªÃœ should continue if notification fails (4 ms)

PASS __tests__/accessibility/button.test.tsx
  Button Accessibility
    Î“ÃªÃœ should import Button component without errors (51 ms)
    Î“ÃªÃœ should have accessibility best practices documented (1 ms)
    Button Accessibility Standards
      Î“ÃªÃœ should document minimum touch target size (4 ms)
      Î“ÃªÃœ should verify button styles meet accessibility standards (5 ms)
      Î“ÃªÃœ should verify focus state styles are implemented (2 ms)
    WCAG 2.5.5 - Touch Target Size
      Î“ÃªÃœ should verify button minHeight meets WCAG standards (2 ms)
      Î“ÃªÃœ should verify size variants meet accessibility standards (3 ms)
    WCAG 2.4.7 - Focus Visible
      Î“ÃªÃœ should verify focus state implementation (2 ms)
    Best Practices
      Î“ÃªÃœ should verify haptic feedback implementation (2 ms)
      Î“ÃªÃœ should verify all button variants are defined (4 ms)

PASS __tests__/unit/security/two-factor-auth.test.ts
  2FA Enrollment Flow
    Enrollment
      Î“ÃªÃœ should successfully enroll TOTP factor (3 ms)
      Î“ÃªÃœ should handle enrollment errors (1 ms)
      Î“ÃªÃœ should prevent enrollment without email verification (1 ms)
    Verification
      Î“ÃªÃœ should successfully verify TOTP code (1 ms)
      Î“ÃªÃœ should reject invalid TOTP code (4 ms)
      Î“ÃªÃœ should handle expired codes
    Factor Management
      Î“ÃªÃœ should list enrolled factors (1 ms)
      Î“ÃªÃœ should return empty when no factors enrolled (1 ms)
      Î“ÃªÃœ should successfully unenroll factor (54 ms)
      Î“ÃªÃœ should handle unenroll errors (1 ms)
    Security Requirements
      Î“ÃªÃœ should never expose TOTP secret in logs (2 ms)
      Î“ÃªÃœ should require email verification before 2FA enrollment (1 ms)
  2FA UI Component Tests
    Î“Â£Ã„ todo should display 2FA toggle in settings
    Î“Â£Ã„ todo should show QR code during enrollment
    Î“Â£Ã„ todo should prompt for verification code
    Î“Â£Ã„ todo should show enabled status after successful setup
    Î“Â£Ã„ todo should confirm before disabling 2FA
    Î“Â£Ã„ todo should be accessible to screen readers
  2FA Integration Tests
    Î“Â£Ã„ todo should complete full enrollment flow
    Î“Â£Ã„ todo should require 2FA on next sign-in after enabling
    Î“Â£Ã„ todo should allow disabling 2FA with confirmation
    Î“Â£Ã„ todo should handle enrollment cancellation correctly
    Î“Â£Ã„ todo should support backup codes for recovery

PASS __tests__/integration/auth-signup-autosignin.test.ts
  Auto Sign-In After Account Creation
    Successful auto-signin with profile check routing to onboarding
      Î“ÃªÃœ should keep user signed in and route to onboarding when profile does not exist (4 ms)
      Î“ÃªÃœ should route to onboarding when profile exists but has no username (2 ms)
      Î“ÃªÃœ should route to onboarding when onboarding_completed is false (2 ms)
      Î“ÃªÃœ should route to onboarding when onboarding_completed is null (3 ms)
    Edge case: Auto-signin when profile is already complete
      Î“ÃªÃœ should route to main app when profile is complete and onboarding_completed is true (2 ms)
    Fallback to email confirmation when no session is created
      Î“ÃªÃœ should fallback to email confirmation screen when session is null (1 ms)
    Error handling and resilience
      Î“ÃªÃœ should handle profile check error gracefully and proceed to onboarding (1 ms)
      Î“ÃªÃœ should handle non-PGRST116 profile errors by throwing and proceeding to onboarding (54 ms)
    Security: Form data clearing
      Î“ÃªÃœ should clear form data after successful signup for security
    Comparison: Old vs New Behavior
      Î“ÃªÃœ OLD BEHAVIOR: would have called signOut after signup (1 ms)
      Î“ÃªÃœ NEW BEHAVIOR: maintains session and routes based on profile status (3 ms)

PASS __tests__/unit/security/phone-verification.test.ts
  Phone Verification Service
    sendPhoneOTP
      Î“ÃªÃœ should successfully send OTP to valid phone number (11 ms)
      Î“ÃªÃœ should format US phone numbers to E.164 (2 ms)
      Î“ÃªÃœ should handle rate limiting errors (2 ms)
      Î“ÃªÃœ should reject invalid phone numbers (2 ms)
      Î“ÃªÃœ should handle network errors gracefully (2 ms)
    verifyPhoneOTP
      Î“ÃªÃœ should successfully verify valid OTP (1 ms)
      Î“ÃªÃœ should reject invalid OTP format (3 ms)
      Î“ÃªÃœ should reject non-numeric OTP (1 ms)
      Î“ÃªÃœ should handle expired OTP (1 ms)
      Î“ÃªÃœ should handle incorrect OTP (5 ms)
    checkPhoneVerified
      Î“ÃªÃœ should return true when phone is verified (47 ms)
      Î“ÃªÃœ should return false when phone not verified (1 ms)
      Î“ÃªÃœ should return false when no session (1 ms)
      Î“ÃªÃœ should handle errors gracefully
    updatePhoneNumber
      Î“ÃªÃœ should successfully update phone number (1 ms)
      Î“ÃªÃœ should reset verification status when phone changes (1 ms)
      Î“ÃªÃœ should handle update errors (1 ms)
  Phone Verification Integration
    Î“Â£Ã„ todo should complete full verification flow
    Î“Â£Ã„ todo should handle OTP resend correctly
    Î“Â£Ã„ todo should enforce rate limits
    Î“Â£Ã„ todo should handle international phone numbers

PASS __tests__/unit/logout-optimization.test.ts
  Logout Speed Optimization
    Local Signout Priority
      Î“ÃªÃœ should call local signout immediately (11 ms)
      Î“ÃªÃœ should not wait for server signout to complete (6 ms)
    Background Cleanup Operations
      Î“ÃªÃœ should run cleanup operations in parallel (6 ms)
      Î“ÃªÃœ should not block on cleanup operation failures (3 ms)
    Navigation Priority
      Î“ÃªÃœ should navigate before cleanup completes (4 ms)
    Analytics Non-Blocking
      Î“ÃªÃœ should not await analytics operations on SIGNED_OUT event (17 ms)
    Performance Benchmarks
      Î“ÃªÃœ should complete critical logout path in under 100ms (3 ms)
      Î“ÃªÃœ should handle slow background operations without blocking (5 ms)

PASS __tests__/unit/haptic-feedback.test.ts
  Haptic Feedback
    Impact Feedback
      Î“ÃªÃœ should trigger light impact feedback (4 ms)
      Î“ÃªÃœ should trigger medium impact feedback (1 ms)
      Î“ÃªÃœ should trigger heavy impact feedback (2 ms)
    Notification Feedback
      Î“ÃªÃœ should trigger success notification feedback (1 ms)
      Î“ÃªÃœ should trigger warning notification feedback (1 ms)
      Î“ÃªÃœ should trigger error notification feedback (28 ms)
    Selection Feedback
      Î“ÃªÃœ should trigger selection feedback (1 ms)

PASS __tests__/integration/profile-loading.test.ts
  Profile Loading and Creation
    Profile Creation on Auth User Creation
      Î“ÃªÃœ should return onboarding needed state when user has no profile (13 ms)
      Î“ÃªÃœ should notify listeners even when profile fetch fails (3 ms)
    Loading State Management
      Î“ÃªÃœ should clear loading state when profile fetch fails (1 ms)
      Î“ÃªÃœ should notify listeners when no data is returned from query (2 ms)
    Race Condition Handling
      Î“ÃªÃœ should handle concurrent profile access attempts (3 ms)
    Onboarding Completion Tracking
      Î“ÃªÃœ should return onboarding_needed state for users without profiles (2 ms)

PASS __tests__/unit/utils/image-utils.test.ts
  image-utils
    constants
      Î“ÃªÃœ should have correct MAX_IMAGE_WIDTH (4 ms)
      Î“ÃªÃœ should have correct MAX_IMAGE_HEIGHT (1 ms)
      Î“ÃªÃœ should have correct MAX_FILE_SIZE_BYTES (500KB) (1 ms)
      Î“ÃªÃœ should have correct DEFAULT_COMPRESS_QUALITY (1 ms)
      Î“ÃªÃœ should have correct MIN_COMPRESS_QUALITY (1 ms)
      Î“ÃªÃœ should have correct QUALITY_STEP (1 ms)
      Î“ÃªÃœ should have correct MAX_COMPRESSION_ITERATIONS
      Î“ÃªÃœ should have correct MIN_SIZE_REDUCTION_THRESHOLD (1 ms)
    estimateFileSizeFromBase64
      Î“ÃªÃœ should correctly estimate file size from base64 string (1 ms)
      Î“ÃªÃœ should handle empty string (1 ms)
      Î“ÃªÃœ should handle large base64 strings (1 ms)
      Î“ÃªÃœ should round up for non-exact divisions
    getCenteredSquareCrop
      Î“ÃªÃœ should return a centered square crop for landscape images (1 ms)
      Î“ÃªÃœ should return a centered square crop for portrait images (2 ms)
      Î“ÃªÃœ should return the full image for square images (4 ms)
      Î“ÃªÃœ should handle small images (2 ms)
      Î“ÃªÃœ should handle 1:1 ratio at various sizes (5 ms)
      Î“ÃªÃœ should use floor for odd dimension differences (2 ms)

PASS __tests__/unit/services/payment-error-handler.test.ts
  Payment Error Handler
    parsePaymentError
      Î“ÃªÃœ should categorize card_declined errors correctly (3 ms)
      Î“ÃªÃœ should categorize insufficient_funds errors (1 ms)
      Î“ÃªÃœ should categorize authentication_required errors (1 ms)
      Î“ÃªÃœ should categorize rate_limit_error correctly (1 ms)
      Î“ÃªÃœ should categorize validation errors (1 ms)
      Î“ÃªÃœ should categorize network errors (1 ms)
      Î“ÃªÃœ should categorize fraud errors (1 ms)
      Î“ÃªÃœ should categorize duplicate transaction errors (1 ms)
      Î“ÃªÃœ should handle unknown errors (1 ms)
    idempotency key management
      Î“ÃªÃœ should generate deterministic idempotency keys (51 ms)
      Î“ÃªÃœ should detect duplicate payments (3 ms)
    getRecoveryInstructions
      Î“ÃªÃœ should return retry instructions (1 ms)
      Î“ÃªÃœ should return update card instructions (1 ms)
      Î“ÃªÃœ should return verify identity instructions (1 ms)
    getPaymentErrorResponse
      Î“ÃªÃœ should return complete error response for UI (4 ms)
      Î“ÃªÃœ should show retry button for retryable errors (1 ms)
      Î“ÃªÃœ should show contact support for fraud errors (1 ms)
    withPaymentRetry
      Î“ÃªÃœ should succeed on first try (2 ms)
      Î“ÃªÃœ should retry on transient errors (75 ms)
      Î“ÃªÃœ should not retry on non-retryable errors (1 ms)
      Î“ÃªÃœ should throw after max retries (92 ms)

PASS lib/security/__tests__/input-sanitization.test.ts
  Input Sanitization
    sanitizeText
      Î“ÃªÃœ should remove null bytes (2 ms)
      Î“ÃªÃœ should trim whitespace (1 ms)
    sanitizeHTML
      Î“ÃªÃœ should remove script tags (2 ms)
    sanitizeEmail
      Î“ÃªÃœ should convert to lowercase

PASS __tests__/unit/utils/avatar-utils.test.ts
  getValidAvatarUrl
    valid URLs
      Î“ÃªÃœ should return valid https URLs unchanged (2 ms)
      Î“ÃªÃœ should return valid http URLs unchanged
      Î“ÃªÃœ should allow URLs with "placeholder" in valid path segments
      Î“ÃªÃœ should allow CDN URLs with query parameters (1 ms)
    invalid URLs
      Î“ÃªÃœ should return undefined for placeholder.svg URLs (4 ms)
      Î“ÃªÃœ should return undefined for relative URLs starting with / (1 ms)
      Î“ÃªÃœ should return undefined for non-http(s) schemes (1 ms)
      Î“ÃªÃœ should return undefined for null input (1 ms)
      Î“ÃªÃœ should return undefined for undefined input (1 ms)
      Î“ÃªÃœ should return undefined for empty string (1 ms)
      Î“ÃªÃœ should return undefined for URLs with placeholder.svg in path
  getAvatarInitials
    normal inputs
      Î“ÃªÃœ should return first 2 characters uppercase for normal username (2 ms)
      Î“ÃªÃœ should return first 2 characters uppercase for username with spaces (1 ms)
      Î“ÃªÃœ should handle mixed case (1 ms)
      Î“ÃªÃœ should handle username with numbers (48 ms)
    edge cases
      Î“ÃªÃœ should return default "U" for null input (1 ms)
      Î“ÃªÃœ should return default "U" for undefined input
      Î“ÃªÃœ should return default "U" for empty string
      Î“ÃªÃœ should return single character uppercase for 1-char username (2 ms)
      Î“ÃªÃœ should handle special characters (5 ms)
      Î“ÃªÃœ should handle unicode characters (1 ms)
    custom maxLength
      Î“ÃªÃœ should respect custom maxLength of 1
      Î“ÃªÃœ should respect custom maxLength of 3
      Î“ÃªÃœ should handle maxLength greater than username length (1 ms)

PASS __tests__/unit/security/email-verification.test.ts
  Email Verification Service
    checkEmailVerified
      Î“ÃªÃœ should return true when email is verified (3 ms)
      Î“ÃªÃœ should return true when confirmed_at is set (1 ms)
      Î“ÃªÃœ should return false when email is not verified (1 ms)
      Î“ÃªÃœ should return false when no session exists
      Î“ÃªÃœ should handle errors gracefully (1 ms)
    resendVerification
      Î“ÃªÃœ should successfully resend verification email (3 ms)
      Î“ÃªÃœ should normalize email address (1 ms)
      Î“ÃªÃœ should handle rate limiting error (2 ms)
      Î“ÃªÃœ should handle generic errors (1 ms)
      Î“ÃªÃœ should handle network errors (2 ms)
  Email Verification Hook
    Î“Â£Ã„ todo should provide correct verification status from auth context
    Î“Â£Ã„ todo should update when verification status changes
    Î“Â£Ã„ todo should provide canPostBounties permission
    Î“Â£Ã„ todo should provide canWithdrawFunds permission
    Î“Â£Ã„ todo should refresh verification status on demand
  Email Verification Banner
    Î“Â£Ã„ todo should render when user is not verified
    Î“Â£Ã„ todo should not render when user is verified
    Î“Â£Ã„ todo should show resend button
    Î“Â£Ã„ todo should call resendVerification when button clicked
    Î“Â£Ã„ todo should show success message after resend
    Î“Â£Ã„ todo should be dismissable
  Email Verification Gates
    Î“Â£Ã„ todo should block bounty posting when email not verified
    Î“Â£Ã„ todo should allow bounty posting when email verified
    Î“Â£Ã„ todo should block withdrawals when email not verified
    Î“Â£Ã„ todo should allow withdrawals when email verified
    Î“Â£Ã„ todo should show appropriate error messages

PASS __tests__/unit/utils/utils.test.ts
  Utils - cn function
    Î“ÃªÃœ should merge class names (29 ms)
    Î“ÃªÃœ should handle conditional classes (1 ms)
    Î“ÃªÃœ should handle undefined and null values (1 ms)
    Î“ÃªÃœ should merge tailwind classes correctly (3 ms)
    Î“ÃªÃœ should handle empty input
    Î“ÃªÃœ should handle array of classes (1 ms)
    Î“ÃªÃœ should handle object notation (3 ms)

PASS __tests__/unit/utils/bounty-validation.test.ts
  Bounty Validation Utils
    validateBalance
      Î“ÃªÃœ should return true when amount is within balance (4 ms)
      Î“ÃªÃœ should return true when amount equals balance (1 ms)
      Î“ÃªÃœ should return false when amount exceeds balance
      Î“ÃªÃœ should always return true for honor bounties regardless of balance (1 ms)
      Î“ÃªÃœ should handle zero balance for paid bounties (1 ms)
      Î“ÃªÃœ should handle zero balance for honor bounties
    getInsufficientBalanceMessage
      Î“ÃªÃœ should format error message with amount and balance (4 ms)
      Î“ÃªÃœ should format balance with two decimal places (1 ms)
      Î“ÃªÃœ should suggest adding funds (1 ms)
      Î“ÃªÃœ should suggest choosing a lower amount
    validateAmount
      Î“ÃªÃœ should return null for valid paid bounty amount
      Î“ÃªÃœ should return null for honor bounties with any amount (1 ms)
      Î“ÃªÃœ should return error for paid bounty with zero amount (1 ms)
      Î“ÃªÃœ should return error for paid bounty with amount less than 1 (2 ms)
      Î“ÃªÃœ should accept amount of exactly 1 dollar (1 ms)
      Î“ÃªÃœ should accept large amounts (1 ms)
      Î“ÃªÃœ should handle negative amounts for paid bounties
      Î“ÃªÃœ should return error for negative amounts for honor bounties (1 ms)

PASS __tests__/unit/components/wallet-transaction-display.test.ts
  Wallet Transaction Display
    getTransactionLabel
      Î“ÃªÃœ should format deposit transaction with method (3 ms)
      Î“ÃªÃœ should format deposit transaction without method (1 ms)
      Î“ÃªÃœ should format withdrawal transaction with method
      Î“ÃªÃœ should format bounty_posted transaction with title (1 ms)
      Î“ÃªÃœ should format bounty_completed transaction (1 ms)
      Î“ÃªÃœ should format bounty_received transaction (1 ms)
      Î“ÃªÃœ should format escrow transaction (1 ms)
      Î“ÃªÃœ should format release transaction (1 ms)
      Î“ÃªÃœ should format refund transaction (1 ms)
      Î“ÃªÃœ should handle transactions without titles gracefully (1 ms)
    Transaction Preview Logic
      Î“ÃªÃœ should limit recent transactions to 5 (2 ms)
      Î“ÃªÃœ should show all transactions when fewer than 5 exist (1 ms)

FAIL services/api/src/__tests__/monitoring.test.ts (14.931 s)
  APM Monitoring
    Metrics Collection
      â”œÃ¹ should record HTTP requests (129 ms)
      â”œÃ¹ should record HTTP errors (2 ms)
      â”œÃ¹ should calculate response time percentiles (5 ms)
      â”œÃ¹ should record database queries (1 ms)
      â”œÃ¹ should record failed database queries (2 ms)
      â”œÃ¹ should record payment transactions (6 ms)
      â”œÃ¹ should record failed payment transactions (2 ms)
    Business Metrics
      â”œÃ¹ should track bounty creation (4 ms)
      Î“ÃªÃœ should track bounty acceptance (2 ms)
      Î“ÃªÃœ should track bounty completion (8 ms)
      â”œÃ¹ should calculate completion rate (5 ms)
      â”œÃ¹ should track payment success rate (4 ms)
      â”œÃ¹ should track user signups (2 ms)
    Alerting
      â”œÃ¹ should trigger high error rate alert (6 ms)
      â”œÃ¹ should trigger slow API response alert (4 ms)
      â”œÃ¹ should trigger payment failure rate alert (10 ms)
      Î“ÃªÃœ should not trigger alerts when thresholds are not exceeded (9 ms)
    Prometheus Metrics Format
      Î“ÃªÃœ should export metrics in Prometheus format (7 ms)
    JSON Metrics Format
      Î“ÃªÃœ should export metrics as JSON (4 ms)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should record HTTP requests

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      17 |       
      18 |       const total = metrics.getCounter(METRICS.HTTP_REQUESTS_TOTAL);
    > 19 |       expect(total).toBeGreaterThan(0);
         |                     ^
      20 |     });
      21 |
      22 |     it('should record HTTP errors', () => {

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:19:21)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should record HTTP errors

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      24 |       
      25 |       const errors = metrics.getCounter(METRICS.HTTP_ERRORS_TOTAL);
    > 26 |       expect(errors).toBeGreaterThan(0);
         |                      ^
      27 |     });
      28 |
      29 |     it('should calculate response time percentiles', () => {

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:26:22)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should calculate response time percentiles

    expect(received).toBeDefined()

    Received: undefined

      34 |       
      35 |       const histogram = metrics.getHistogram(METRICS.HTTP_REQUEST_DURATION_MS);
    > 36 |       expect(histogram).toBeDefined();
         |                         ^
      37 |       expect(histogram?.count).toBe(100);
      38 |       expect(histogram?.sum).toBeGreaterThan(0);
      39 |     });

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:36:25)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should record database queries

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      43 |       
      44 |       const total = metrics.getCounter(METRICS.DB_QUERIES_TOTAL);
    > 45 |       expect(total).toBeGreaterThan(0);
         |                     ^
      46 |     });
      47 |
      48 |     it('should record failed database queries', () => {

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:45:21)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should record failed database queries

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      50 |       
      51 |       const errors = metrics.getCounter(METRICS.DB_ERRORS_TOTAL);
    > 52 |       expect(errors).toBeGreaterThan(0);
         |                      ^
      53 |     });
      54 |
      55 |     it('should record payment transactions', () => {

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:52:22)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should record payment transactions

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 0

      59 |       const successful = metrics.getCounter(METRICS.PAYMENT_SUCCESS_TOTAL);
      60 |       
    > 61 |       expect(total).toBe(1);
         |                     ^
      62 |       expect(successful).toBe(1);
      63 |     });
      64 |

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:61:21)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should record failed payment transactions

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 0

      69 |       const failed = metrics.getCounter(METRICS.PAYMENT_FAILURES_TOTAL);
      70 |       
    > 71 |       expect(total).toBe(1);
         |                     ^
      72 |       expect(failed).toBe(1);
      73 |     });
      74 |   });

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:71:21)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Business Metrics Î“Ã‡â•‘ should track bounty creation

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 0

      79 |       
      80 |       const summary = businessMetrics.getSummary();
    > 81 |       expect(summary.bounties.created).toBe(1);
         |                                        ^
      82 |     });
      83 |
      84 |     it('should track bounty acceptance', () => {

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:81:40)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Business Metrics Î“Ã‡â•‘ should calculate completion rate

    expect(received).toBe(expected) // Object.is equality

    Expected: 50
    Received: 0

      102 |       
      103 |       const summary = businessMetrics.getSummary();
    > 104 |       expect(summary.bounties.completionRate).toBe(50);
          |                                               ^
      105 |     });
      106 |
      107 |     it('should track payment success rate', () => {

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:104:47)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Business Metrics Î“Ã‡â•‘ should track payment success rate

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 0

      111 |       
      112 |       const summary = businessMetrics.getSummary();
    > 113 |       expect(summary.payments.total).toBe(3);
          |                                      ^
      114 |       expect(summary.payments.successful).toBe(2);
      115 |       expect(summary.payments.failed).toBe(1);
      116 |       expect(summary.payments.successRate).toBeCloseTo(66.67, 1);

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:113:38)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Business Metrics Î“Ã‡â•‘ should track user signups

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 0

      122 |       
      123 |       const summary = businessMetrics.getSummary();
    > 124 |       expect(summary.users.signups).toBe(2);
          |                                     ^
      125 |     });
      126 |   });
      127 |

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:124:37)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Alerting Î“Ã‡â•‘ should trigger high error rate alert

    expect(received).toBeDefined()

    Received: undefined

      141 |       const errorRateAlert = activeAlerts.find(a => a.rule === 'high_error_rate');
      142 |       
    > 143 |       expect(errorRateAlert).toBeDefined();
          |                              ^
      144 |       expect(errorRateAlert?.severity).toBe('critical');
      145 |     });
      146 |

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:143:30)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Alerting Î“Ã‡â•‘ should trigger slow API response alert

    expect(received).toBeDefined()

    Received: undefined

      157 |       const slowApiAlert = activeAlerts.find(a => a.rule === 'slow_api_response_time');
      158 |       
    > 159 |       expect(slowApiAlert).toBeDefined();
          |                            ^
      160 |       expect(slowApiAlert?.severity).toBe('critical');
      161 |     });
      162 |

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:159:28)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Alerting Î“Ã‡â•‘ should trigger payment failure rate alert

    expect(received).toBeDefined()

    Received: undefined

      172 |       const paymentAlert = activeAlerts.find(a => a.rule === 'payment_failure_rate');
      173 |       
    > 174 |       expect(paymentAlert).toBeDefined();
          |                            ^
      175 |       expect(paymentAlert?.severity).toBe('critical');
      176 |     });
      177 |

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:174:28)

PASS __tests__/unit/components/chat-enhancements.test.ts
  Chat Enhancements - Type Tests
    Read Receipts
      Î“ÃªÃœ should support status property on messages (2 ms)
      Î“ÃªÃœ should support all status types (2 ms)
      Î“ÃªÃœ should make status optional (1 ms)
      Î“ÃªÃœ should support status transitions (2 ms)
    Typing Indicator State
      Î“ÃªÃœ should track typing state (1 ms)
      Î“ÃªÃœ should support typing callback signature (38 ms)
    Message Animation Properties
      Î“ÃªÃœ should identify new messages for animation (1 ms)
    Integration - All Features
      Î“ÃªÃœ should support messages with all enhancement features (2 ms)
      Î“ÃªÃœ should simulate complete chat flow with enhancements (4 ms)

PASS __tests__/integration/api/wallet-balance.test.ts
  Wallet Balance Endpoint
    GET /wallet/balance
      Î“ÃªÃœ should return balance for authenticated user (4 ms)
      Î“ÃªÃœ should require authentication (1 ms)
      Î“ÃªÃœ should handle users with no transactions (1 ms)
      Î“ÃªÃœ should calculate balance correctly for multiple transaction types (1 ms)
      Î“ÃªÃœ should handle database errors gracefully

[16:25:02 UTC] [32mINFO[39m: [36m[metrics] Metrics collector initialized[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
[16:25:02 UTC] [32mINFO[39m (high_error_rate): [36m[alerts] Added alert rule[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35mseverity[39m: "critical"
[16:25:02 UTC] [32mINFO[39m (slow_api_response_time): [36m[alerts] Added alert rule[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35mseverity[39m: "critical"
[16:25:02 UTC] [32mINFO[39m (slow_database_query): [36m[alerts] Added alert rule[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35mseverity[39m: "critical"
[16:25:02 UTC] [32mINFO[39m (db_connection_failures): [36m[alerts] Added alert rule[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35mseverity[39m: "critical"
[16:25:02 UTC] [32mINFO[39m (payment_failure_rate): [36m[alerts] Added alert rule[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35mseverity[39m: "critical"
[16:25:02 UTC] [32mINFO[39m (websocket_surge): [36m[alerts] Added alert rule[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35mseverity[39m: "warning"
[16:25:02 UTC] [32mINFO[39m: [36m[alerts] Alerting service initialized[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
[16:25:12 UTC] [32mINFO[39m: [36m[business-metrics] Business metrics service initialized[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
[16:25:12 UTC] [34mDEBUG[39m: [36m[business-metrics] Bounty created[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35mbountyId[39m: "bounty-1"
    [35muserId[39m: "user-1"
    [35mamountCents[39m: 10000
[16:25:12 UTC] [34mDEBUG[39m: [36m[business-metrics] Bounty accepted[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35mbountyId[39m: "bounty-1"
    [35mhunterId[39m: "hunter-1"
[16:25:12 UTC] [34mDEBUG[39m: [36m[business-metrics] Bounty completed[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35mbountyId[39m: "bounty-1"
    [35mhunterId[39m: "hunter-1"
    [35mamountCents[39m: 10000
[16:25:12 UTC] [34mDEBUG[39m: [36m[business-metrics] Bounty created[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35mbountyId[39m: "bounty-1"
    [35muserId[39m: "user-1"
    [35mamountCents[39m: 10000
[16:25:12 UTC] [34mDEBUG[39m: [36m[business-metrics] Bounty created[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35mbountyId[39m: "bounty-2"
    [35muserId[39m: "user-1"
    [35mamountCents[39m: 20000
[16:25:12 UTC] [34mDEBUG[39m: [36m[business-metrics] Bounty completed[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35mbountyId[39m: "bounty-1"
    [35mhunterId[39m: "hunter-1"
    [35mamountCents[39m: 10000
[16:25:12 UTC] [34mDEBUG[39m: [36m[business-metrics] Payment tracked[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35msuccess[39m: true
    [35mamountCents[39m: 10000
    [35mpaymentType[39m: "escrow"
    [35muserId[39m: "user-1"
    [35mbountyId[39m: "bounty-1"
[16:25:12 UTC] [34mDEBUG[39m: [36m[business-metrics] Payment tracked[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35msuccess[39m: true
    [35mamountCents[39m: 15000
    [35mpaymentType[39m: "release"
    [35muserId[39m: "user-2"
    [35mbountyId[39m: "bounty-2"
[16:25:12 UTC] [34mDEBUG[39m: [36m[business-metrics] Payment tracked[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35msuccess[39m: false
    [35mamountCents[39m: 5000
    [35mpaymentType[39m: "escrow"
    [35muserId[39m: "user-3"
    [35mbountyId[39m: "bounty-3"
[16:25:12 UTC] [34mDEBUG[39m: [36m[business-metrics] User signup tracked[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35muserId[39m: "user-1"
    [35mmethod[39m: "email"
[16:25:12 UTC] [34mDEBUG[39m: [36m[business-metrics] User signup tracked[39m
    [35menv[39m: "test"
    [35mservice[39m: "bountyexpo-api"
    [35muserId[39m: "user-2"
    [35mmethod[39m: "social"
FAIL __tests__/unit/services/refund-service.test.ts
  Î“Ã¹Ã… Test suite failed to run

    Cannot find module '../../../services/api/src/utils/logger' from '__tests__/unit/services/refund-service.test.ts'

      79 |
      80 | // Mock logger
    > 81 | jest.mock('../../../services/api/src/utils/logger', () => ({
         |      ^
      82 |   logger: {
      83 |     info: jest.fn(),
      84 |     error: jest.fn(),

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (__tests__/unit/services/refund-service.test.ts:81:6)

PASS __tests__/unit/services/consolidated-wallet-service.test.ts
  Consolidated Wallet Service
    getBalance
      Î“ÃªÃœ should return wallet balance for user (4 ms)
    getTransactions
      Î“ÃªÃœ should return transaction history (2 ms)
    createDeposit
      Î“ÃªÃœ should create a deposit (3 ms)
    createWithdrawal
      Î“ÃªÃœ should create a withdrawal (2 ms)
    createEscrow
      Î“ÃªÃœ should create escrow (3 ms)
    releaseEscrow
      Î“ÃªÃœ should release escrow (4 ms)
    refundEscrow
      Î“ÃªÃœ should refund escrow (3 ms)
    updateBalance
      Î“ÃªÃœ should update balance atomically (2 ms)

PASS __tests__/unit/services/consolidated-payment-service.test.ts
  Consolidated Payment Service
    createPaymentIntent
      Î“ÃªÃœ should create a payment intent (5 ms)
    listPaymentMethods
      Î“ÃªÃœ should list payment methods (19 ms)

FAIL services/api/src/__tests__/websocket-integration.test.ts
  Î“Ã¹Ã… Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL __tests__/unit/services/completion-release-service.test.ts
  Î“Ã¹Ã… Test suite failed to run

    Cannot find module '../../../services/api/src/db' from '__tests__/unit/services/completion-release-service.test.ts'

      57 | };
      58 |
    > 59 | jest.mock('../../../services/api/src/db', () => ({
         |      ^
      60 |   db: mockDb,
      61 | }));
      62 |

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (__tests__/unit/services/completion-release-service.test.ts:59:6)

  Î“Ã¹Ã…  process.exit called with "1"

      686 |         
      687 |         ws.on('error', () => resolve());
    > 688 |         
          |         ^
      689 |         setTimeout(() => resolve(), 2000);
      690 |       });
      691 |       

      at runAllTests (services/api/src/__tests__/websocket-integration.test.ts:688:17)
PASS __tests__/components/success-animation.test.tsx
  SuccessAnimation
    Î“ÃªÃœ should render nothing when not visible (5 ms)
    Î“ÃªÃœ should render when visible (2 ms)
    Î“ÃªÃœ should call onComplete callback (1 ms)
    Î“ÃªÃœ should accept custom icon and size (1 ms)
  ConfettiAnimation
    Î“ÃªÃœ should render nothing when not visible (2 ms)
    Î“ÃªÃœ should render when visible (2 ms)
    Î“ÃªÃœ should call onComplete callback (2 ms)

PASS __tests__/components/skeleton-card.test.tsx
  SkeletonCard
    Î“ÃªÃœ should render without crashing (2 ms)
    Î“ÃªÃœ should render multiple cards in SkeletonCardList (1 ms)
    Î“ÃªÃœ should use default count of 3 for SkeletonCardList (2 ms)

PASS __tests__/unit/services/stripe-service.test.ts (22.875 s)
  Stripe Service
    initialize
      Î“ÃªÃœ should initialize only once (9 ms)
    createPaymentMethod
      Î“ÃªÃœ should create a payment method with valid card data (fallback mode) (546 ms)
      Î“ÃªÃœ should detect card brand correctly (535 ms)
      Î“ÃªÃœ should handle Mastercard (522 ms)
      Î“ÃªÃœ should include created timestamp (524 ms)
    createPaymentIntent
      Î“ÃªÃœ should create a payment intent with valid amount (3 ms)
      Î“ÃªÃœ should track analytics event on success (9 ms)
      Î“ÃªÃœ should measure performance (2 ms)
      Î“ÃªÃœ should use USD as default currency (2 ms)
      Î“ÃªÃœ should handle different currencies (1 ms)
    confirmPayment
      Î“ÃªÃœ should have confirmPayment method (2 ms)
    error handling
      Î“ÃªÃœ should handle Stripe API errors gracefully (1 ms)
    listPaymentMethods with network timeout
      Î“ÃªÃœ should handle slow network requests without artificial timeout (20013 ms)
      Î“ÃªÃœ should handle network errors gracefully (2 ms)
      Î“ÃªÃœ should successfully fetch payment methods within timeout (1 ms)
      Î“ÃªÃœ should return empty array when no auth token provided (1 ms)
      Î“ÃªÃœ should handle API errors correctly
      Î“ÃªÃœ should handle network errors with friendly messages

Summary of all failing tests
FAIL __tests__/e2e/complete-payment-flows.test.ts
  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Full Bounty Payment Flow - Happy Path Î“Ã‡â•‘ should complete entire bounty payment lifecycle

    expect(received).toBe(expected) // Object.is equality

    Expected: "release"
    Received: "escrow"

      190 |         .single();
      191 |
    > 192 |       expect(releaseTx.data.type).toBe('release');
          |                                   ^
      193 |       expect(releaseTx.data.amount).toBe(9500);
      194 |       expect(releaseTx.data.platform_fee).toBe(500);
      195 |

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:192:35)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Bounty Cancellation Flow Î“Ã‡â•‘ should handle full refund when bounty is cancelled

    expect(received).toBe(expected) // Object.is equality

    Expected: "refund"
    Received: "escrow"

      246 |         .single();
      247 |
    > 248 |       expect(refundTx.data.type).toBe('refund');
          |                                  ^
      249 |       expect(refundTx.data.amount).toBe(10000);
      250 |
      251 |       // Verify refund flow completed

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:248:34)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Wallet Deposit and Withdrawal Flow Î“Ã‡â•‘ should complete deposit to wallet

    TypeError: mockSupabaseClient.from(...).insert is not a function

      306 |       const depositTx = await mockSupabaseClient
      307 |         .from('wallet_transactions')
    > 308 |         .insert({
          |          ^
      309 |           user_id: 'user123',
      310 |           type: 'deposit',
      311 |           amount: 5000,

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:308:10)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Wallet Deposit and Withdrawal Flow Î“Ã‡â•‘ should complete withdrawal from wallet

    TypeError: mockSupabaseClient.from(...).insert is not a function

      347 |       const withdrawalTx = await mockSupabaseClient
      348 |         .from('wallet_transactions')
    > 349 |         .insert({
          |          ^
      350 |           user_id: 'user123',
      351 |           type: 'withdrawal',
      352 |           amount: 5000,

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:349:10)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Payment Method Management Flow Î“Ã‡â•‘ should save payment method for future use

    TypeError: Cannot read properties of undefined (reading 'create')

      458 |     it('should save payment method for future use', async () => {
      459 |       // Step 1: Create setup intent (for saving payment method)
    > 460 |       mockStripe.setupIntents.create.mockResolvedValueOnce({
          |                               ^
      461 |         id: 'seti_test123',
      462 |         client_secret: 'seti_test123_secret',
      463 |         status: 'requires_payment_method',

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:460:31)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Error Recovery and Retry Logic Î“Ã‡â•‘ should create outbox event for failed release

    TypeError: mockSupabaseClient.from(...).insert is not a function

      585 |       await mockSupabaseClient
      586 |         .from('outbox_events')
    > 587 |         .insert({
          |          ^
      588 |           event_type: 'escrow_release_retry',
      589 |           payload: releaseRequest,
      590 |           status: 'pending',

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:587:10)

  Î“Ã¹Ã… Complete Payment Flow E2E Tests Î“Ã‡â•‘ Security and Validation Î“Ã‡â•‘ should validate hunter assignment before release

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      621 |       const isCorrectHunter = bounty.data.hunter_id === releaseToHunterId;
      622 |
    > 623 |       expect(isCorrectHunter).toBe(true);
          |                               ^
      624 |     });
      625 |
      626 |     it('should prevent refund after release', async () => {

      at Object.<anonymous> (__tests__/e2e/complete-payment-flows.test.ts:623:31)

FAIL __tests__/integration/edit-profile-flow.test.ts
  Î“Ã¹Ã… Edit Profile Integration Flow Î“Ã‡â•‘ Profile Update Î“Ã‡â•‘ should update profile successfully

    expect(received).not.toBeNull()

    Received: null

      158 |       });
      159 |
    > 160 |       expect(result).not.toBeNull();
          |                          ^
      161 |       expect(result?.username).toBe('johndoe_updated');
      162 |       expect(result?.about).toBe('Updated bio');
      163 |     });

      at Object.<anonymous> (__tests__/integration/edit-profile-flow.test.ts:160:26)

  Î“Ã¹Ã… Edit Profile Integration Flow Î“Ã‡â•‘ Profile Update Î“Ã‡â•‘ should update avatar URL

    expect(received).not.toBeNull()

    Received: null

      205 |       } as any);
      206 |
    > 207 |       expect(result).not.toBeNull();
          |                          ^
      208 |       expect(result?.avatar).toBe(avatarUrl);
      209 |     });
      210 |   });

      at Object.<anonymous> (__tests__/integration/edit-profile-flow.test.ts:207:26)

  Î“Ã¹Ã… Edit Profile Integration Flow Î“Ã‡â•‘ Avatar Upload Flow Î“Ã‡â•‘ should upload avatar and update profile

    expect(received).toBe(expected) // Object.is equality

    Expected: "https://storage.example.com/avatars/123-avatar.jpg"
    Received: undefined

      255 |       } as any);
      256 |
    > 257 |       expect(result?.avatar).toBe(uploadedUrl);
          |                              ^
      258 |     });
      259 |
      260 |     it('should handle upload failure and retry', async () => {

      at Object.<anonymous> (__tests__/integration/edit-profile-flow.test.ts:257:30)

  Î“Ã¹Ã… Edit Profile Integration Flow Î“Ã‡â•‘ Complete Edit Flow Î“Ã‡â•‘ should complete full profile edit flow

    expect(received).not.toBeNull()

    Received: null

      563 |       } as any);
      564 |
    > 565 |       expect(result).not.toBeNull();
          |                          ^
      566 |       expect(result?.username).toBe('johndoe_new');
      567 |       expect(result?.about).toBe('Updated developer bio');
      568 |       expect(result?.avatar).toBe(avatarUrl);

      at Object.<anonymous> (__tests__/integration/edit-profile-flow.test.ts:565:26)

  Î“Ã¹Ã… Edit Profile Integration Flow Î“Ã‡â•‘ Concurrent Operations Î“Ã‡â•‘ should handle simultaneous profile updates

    expect(received).not.toBeNull()

    Received: null

      627 |       
      628 |       // Both should complete without crashing
    > 629 |       expect(results[0]).not.toBeNull();
          |                              ^
      630 |       expect(results[1]).not.toBeNull();
      631 |     });
      632 |   });

      at Object.<anonymous> (__tests__/integration/edit-profile-flow.test.ts:629:30)

FAIL services/api/src/__tests__/bank-accounts.test.ts
  Î“Ã¹Ã… Bank Account Management Î“Ã‡â•‘ addBankAccount Î“Ã‡â•‘ should handle invalid routing number from Stripe API

    TypeError: Cannot read properties of undefined (reading 'mock')

       99 |       const { default: Stripe } = require('stripe');
      100 |       const stripeMock = Stripe as jest.MockedClass<typeof Stripe>;
    > 101 |       const stripeInstance = stripeMock.mock.results[0].value;
          |                                         ^
      102 |       
      103 |       stripeInstance.tokens.create.mockRejectedValueOnce({
      104 |         type: 'StripeInvalidRequestError',

      at Object.<anonymous> (services/api/src/__tests__/bank-accounts.test.ts:101:41)

  Î“Ã¹Ã… Bank Account Management Î“Ã‡â•‘ listBankAccounts Î“Ã‡â•‘ should return empty array if no Connect account

    expect(received).toEqual(expected) // deep equality

    - Expected  -  1
    + Received  + 12

    - Array []
    + Array [
    +   Object {
    +     "accountHolderName": "John Doe",
    +     "accountType": "checking",
    +     "bankName": "STRIPE TEST BANK",
    +     "default": true,
    +     "id": "ba_test_123456",
    +     "last4": "6789",
    +     "routingNumber": "110000000",
    +     "status": "verified",
    +   },
    + ]

      148 |
      149 |       const result = await consolidatedStripeConnectService.listBankAccounts('user_no_account');
    > 150 |       expect(result).toEqual([]);
          |                      ^
      151 |     });
      152 |   });
      153 |

      at Object.<anonymous> (services/api/src/__tests__/bank-accounts.test.ts:150:22)

FAIL __tests__/unit/services/stripe-connect-service.test.ts (5.102 s)
  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ createOnboardingLink Î“Ã‡â•‘ should create onboarding link for existing Stripe account

    expect(jest.fn()).not.toHaveBeenCalled()

    Expected number of calls: 0
    Received number of calls: 1

    1: {"capabilities": {"card_payments": {"requested": true}, "transfers": {"requested": true}}, "settings": {"payouts": {"schedule": {"interval": "daily"}}}, "type": "express"}

      146 |
      147 |       expect(result.url).toBe('https://connect.stripe.com/setup/test');
    > 148 |       expect(mockStripe.accounts.create).not.toHaveBeenCalled();
          |                                              ^
      149 |       expect(mockStripe.accountLinks.create).toHaveBeenCalledWith(
      150 |         expect.objectContaining({
      151 |           account: 'acct_test123',

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:148:46)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ getConnectStatus Î“Ã‡â•‘ should return connect status for user with Stripe account

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      232 |       const result = await stripeConnectService.getConnectStatus('user123');
      233 |
    > 234 |       expect(result.hasStripeAccount).toBe(true);
          |                                       ^
      235 |       expect(result.stripeAccountId).toBe('acct_test123');
      236 |       expect(result.detailsSubmitted).toBe(true);
      237 |       expect(result.chargesEnabled).toBe(true);

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:234:39)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ getConnectStatus Î“Ã‡â•‘ should indicate when account requires action

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

      269 |       const result = await stripeConnectService.getConnectStatus('user123');
      270 |
    > 271 |       expect(result.requiresAction).toBe(true);
          |                                     ^
      272 |       expect(result.currentlyDue).toEqual(['individual.id_number', 'individual.ssn_last_4']);
      273 |     });
      274 |

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:271:37)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ getConnectStatus Î“Ã‡â•‘ should handle incomplete account setup

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

      283 |       const result = await stripeConnectService.getConnectStatus('user123');
      284 |
    > 285 |       expect(result.detailsSubmitted).toBe(false);
          |                                       ^
      286 |       expect(result.chargesEnabled).toBe(false);
      287 |       expect(result.payoutsEnabled).toBe(false);
      288 |     });

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:285:39)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ createEscrowPaymentIntent Î“Ã‡â•‘ should create escrow payment intent for bounty

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"amount": 5000, "currency": "usd", "metadata": ObjectContaining {"bountyId": "bounty123", "type": "escrow"}}
    Received: {"amount": undefined, "capture_method": "automatic", "currency": "usd", "description": "Escrow for bounty: undefined", "metadata": {"bounty_id": "bounty123", "bounty_title": undefined, "creator_id": undefined, "type": "escrow"}, "payment_method_types": ["card"]}

    Number of calls: 1

      325 |       expect(result.clientSecret).toBe('pi_test123_secret_abc');
      326 |       expect(result.amount).toBe(5000);
    > 327 |       expect(mockStripe.paymentIntents.create).toHaveBeenCalledWith(
          |                                                ^
      328 |         expect.objectContaining({
      329 |           amount: 5000,
      330 |           currency: 'usd',

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:327:48)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ createEscrowPaymentIntent Î“Ã‡â•‘ should handle zero amount bounties

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"amount": 5000, "clientSecret": "pi_test123_secret_abc", "currency": "usd", "paymentIntentId": "pi_test123", "status": "requires_payment_method"}

      362 |       }));
      363 |
    > 364 |       await expect(
          |             ^
      365 |         stripeConnectService.createEscrowPaymentIntent('bounty123')
      366 |       ).rejects.toThrow();
      367 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:364:13)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ refundPaymentIntent Î“Ã‡â•‘ should refund a payment intent

    expect(received).toBe(expected) // Object.is equality

    Expected: "ref_test123"
    Received: undefined

      376 |       );
      377 |
    > 378 |       expect(result.id).toBe('ref_test123');
          |                         ^
      379 |       expect(result.amount).toBe(5000);
      380 |       expect(result.status).toBe('succeeded');
      381 |       expect(mockStripe.refunds.create).toHaveBeenCalledWith(

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:378:25)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ refundPaymentIntent Î“Ã‡â•‘ should include refund reason in metadata

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"metadata": ObjectContaining {"reason": "User requested cancellation"}}

    Number of calls: 0

      396 |       );
      397 |
    > 398 |       expect(mockStripe.refunds.create).toHaveBeenCalledWith(
          |                                         ^
      399 |         expect.objectContaining({
      400 |           metadata: expect.objectContaining({
      401 |             reason: 'User requested cancellation',

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:398:41)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ refundPaymentIntent Î“Ã‡â•‘ should handle partial refunds

    expect(received).toBe(expected) // Object.is equality

    Expected: 2500
    Received: undefined

      417 |       );
      418 |
    > 419 |       expect(result.amount).toBe(2500);
          |                             ^
      420 |     });
      421 |
      422 |     it('should handle Stripe refund errors', async () => {

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:419:29)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ refundPaymentIntent Î“Ã‡â•‘ should handle Stripe refund errors

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"error": "this.stripe.paymentIntents.retrieve is not a function", "success": false}

      425 |       );
      426 |
    > 427 |       await expect(
          |             ^
      428 |         stripeConnectService.refundPaymentIntent('pi_test123', 'bounty123')
      429 |       ).rejects.toThrow();
      430 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:427:13)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ validatePaymentCapability Î“Ã‡â•‘ should validate user can make payment

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      438 |       );
      439 |
    > 440 |       expect(result.canPay).toBe(true);
          |                             ^
      441 |       expect(result.error).toBeUndefined();
      442 |     });
      443 |

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:440:29)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ validatePaymentCapability Î“Ã‡â•‘ should return error for user without Stripe account

    expect(received).toBe(expected) // Object.is equality

    Expected: "No Stripe account"
    Received: "User has not set up payment method. Please complete Stripe onboarding first."

      459 |
      460 |       expect(result.canPay).toBe(false);
    > 461 |       expect(result.error).toBe('No Stripe account');
          |                            ^
      462 |     });
      463 |
      464 |     it('should return error for account with charges disabled', async () => {

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:461:28)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ validatePaymentCapability Î“Ã‡â•‘ should return error for account with charges disabled

    expect(received).toBe(expected) // Object.is equality

    Expected: "Charges not enabled"
    Received: "User has not set up payment method. Please complete Stripe onboarding first."

      474 |
      475 |       expect(result.canPay).toBe(false);
    > 476 |       expect(result.error).toBe('Charges not enabled');
          |                            ^
      477 |     });
      478 |
      479 |     it('should validate minimum payment amount', async () => {

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:476:28)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ validatePaymentCapability Î“Ã‡â•‘ should validate minimum payment amount

    expect(received).toContain(expected) // indexOf

    Expected substring: "minimum"
    Received string:    "User has not set up payment method. Please complete Stripe onboarding first."

      484 |
      485 |       expect(result.canPay).toBe(false);
    > 486 |       expect(result.error).toContain('minimum');
          |                            ^
      487 |     });
      488 |
      489 |     it('should handle user not found', async () => {

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:486:28)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ handleWebhook Î“Ã‡â•‘ should handle account.updated webhook

    expect(received).resolves.not.toThrow()

    Received promise rejected instead of resolved
    Rejected to value: [Error: STRIPE_WEBHOOK_SECRET not configured]

      517 |       const signature = 'whsec_test_signature';
      518 |
    > 519 |       await expect(
          |             ^
      520 |         stripeConnectService.handleWebhook(payload, signature)
      521 |       ).resolves.not.toThrow();
      522 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:519:13)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ handleWebhook Î“Ã‡â•‘ should handle payment_intent.succeeded webhook

    expect(received).resolves.not.toThrow()

    Received promise rejected instead of resolved
    Rejected to value: [Error: STRIPE_WEBHOOK_SECRET not configured]

      538 |       const signature = 'whsec_test_signature';
      539 |
    > 540 |       await expect(
          |             ^
      541 |         stripeConnectService.handleWebhook(payload, signature)
      542 |       ).resolves.not.toThrow();
      543 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:540:13)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ handleWebhook Î“Ã‡â•‘ should handle refund.created webhook

    expect(received).resolves.not.toThrow()

    Received promise rejected instead of resolved
    Rejected to value: [Error: STRIPE_WEBHOOK_SECRET not configured]

      556 |       const signature = 'whsec_test_signature';
      557 |
    > 558 |       await expect(
          |             ^
      559 |         stripeConnectService.handleWebhook(payload, signature)
      560 |       ).resolves.not.toThrow();
      561 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:558:13)

  Î“Ã¹Ã… Stripe Connect Service Î“Ã‡â•‘ error handling and edge cases Î“Ã‡â•‘ should handle Stripe service not configured

    TypeError: serviceNoConfig.createOnboardingLink is not a function

      582 |         const serviceNoConfig = require('../../../services/api/src/services/stripe-connect-service');
      583 |         await expect(
    > 584 |           serviceNoConfig.createOnboardingLink({ userId: 'user123' })
          |                           ^
      585 |         ).rejects.toThrow();
      586 |       } finally {
      587 |         process.env.STRIPE_SECRET_KEY = originalEnv;

      at Object.<anonymous> (__tests__/unit/services/stripe-connect-service.test.ts:584:27)

FAIL services/api/src/__tests__/idempotency.test.ts (5.482 s)
  Î“Ã¹Ã… Payment Operations Idempotency Î“Ã‡â•‘ Edge Cases Î“Ã‡â•‘ should reject empty idempotency key

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

      238 |       // Empty idempotency keys should not be treated as valid keys.
      239 |       // The service is expected to reject or otherwise fail on empty input.
    > 240 |       await expect(storeIdempotencyKey(emptyKey)).rejects.toThrow();
          |             ^
      241 |       
      242 |       const check = await checkIdempotencyKey(emptyKey);
      243 |       expect(check).toBe(false);

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (services/api/src/__tests__/idempotency.test.ts:240:13)

FAIL __tests__/components/edit-profile-screen.test.tsx (5.934 s)
  Î“Ã¹Ã… EditProfileScreen Î“Ã‡â•‘ Accessibility Î“Ã‡â•‘ should have proper accessibility labels on all interactive elements

    Found multiple elements with accessibility label: Change profile picture

      349 |       expect(getByLabelText('Cancel editing')).toBeTruthy();
      350 |       expect(getByLabelText('Change banner image')).toBeTruthy();
    > 351 |       expect(getByLabelText('Change profile picture')).toBeTruthy();
          |              ^
      352 |       expect(getByLabelText('Display name')).toBeTruthy();
      353 |       expect(getByLabelText('Username')).toBeTruthy();
      354 |       expect(getByLabelText('Bio')).toBeTruthy();

      at Object.<anonymous> (__tests__/components/edit-profile-screen.test.tsx:351:14)

FAIL services/api/src/__tests__/risk-management.test.ts (7.218 s)
  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Risk Assessment Î“Ã‡â•‘ should assess user risk based on multiple factors

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Risk Assessment Î“Ã‡â•‘ should give higher risk score to new accounts

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Risk Assessment Î“Ã‡â•‘ should give higher risk score to unverified accounts

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Risk Assessment Î“Ã‡â•‘ should recommend reserve for medium+ risk users

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Business Category Compliance Î“Ã‡â•‘ should reject prohibited business categories

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Business Category Compliance Î“Ã‡â•‘ should allow non-restricted categories

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Business Category Compliance Î“Ã‡â•‘ should provide risk level for restricted but allowed categories

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Risk Actions Î“Ã‡â•‘ should create risk action and restrict account

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Risk Actions Î“Ã‡â•‘ should send notification when taking risk action

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Reserve Management Î“Ã‡â•‘ should establish reserve for user

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Reserve Management Î“Ã‡â•‘ should calculate platform liability correctly

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Transaction Pattern Monitoring Î“Ã‡â•‘ should detect high velocity transactions

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Risk Management Service Î“Ã‡â•‘ Transaction Pattern Monitoring Î“Ã‡â•‘ should auto-trigger action for critical velocity

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, $3, default, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: pending,low,0,@test-risk-user

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

    Cause:
    AggregateError:

      16 |   beforeEach(async () => {
      17 |     // Create a test user
    > 18 |     const user = await db
         |                  ^
      19 |       .insert(users)
      20 |       .values({
      21 |         handle: '@test-risk-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:18:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Workflow Creation Î“Ã‡â•‘ should create remediation workflow

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Workflow Creation Î“Ã‡â•‘ should auto-trigger remediation for verification actions

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Document Submission Î“Ã‡â•‘ should accept document submissions

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Review Process Î“Ã‡â•‘ should approve remediation and restore account

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Review Process Î“Ã‡â•‘ should reject remediation with feedback

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Status Tracking Î“Ã‡â•‘ should return remediation status for user

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

  Î“Ã¹Ã… Remediation Service Î“Ã‡â•‘ Status Tracking Î“Ã‡â•‘ should return pending remediations for admin

    Failed query: insert into "profiles" ("id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance") values (default, $1, default, default, $2, default, $3, default, default, $4, default, default, default, default) returning "id", "verification_status", "kyc_verified_at", "business_category", "risk_level", "risk_score", "account_restricted", "restriction_reason", "restricted_at", "username", "stripe_connect_account_id", "created_at", "deleted_at", "balance"
    params: under_review,medium,true,@test-remediation-user

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:73:11)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

    Cause:
    AggregateError:

      240 |   beforeEach(async () => {
      241 |     // Create test user and risk action
    > 242 |     const user = await db
          |                  ^
      243 |       .insert(users)
      244 |       .values({
      245 |         handle: '@test-remediation-user',

      at node_modules/pg-pool/index.js:45:11
      at node_modules/src/node-postgres/session.ts:161:13
      at NodePgPreparedQuery.queryWithCache (node_modules/src/pg-core/session.ts:71:12)
      at node_modules/src/node-postgres/session.ts:154:19
      at Object.<anonymous> (services/api/src/__tests__/risk-management.test.ts:242:18)

FAIL services/api/src/__tests__/monitoring.test.ts (14.931 s)
  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should record HTTP requests

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      17 |       
      18 |       const total = metrics.getCounter(METRICS.HTTP_REQUESTS_TOTAL);
    > 19 |       expect(total).toBeGreaterThan(0);
         |                     ^
      20 |     });
      21 |
      22 |     it('should record HTTP errors', () => {

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:19:21)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should record HTTP errors

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      24 |       
      25 |       const errors = metrics.getCounter(METRICS.HTTP_ERRORS_TOTAL);
    > 26 |       expect(errors).toBeGreaterThan(0);
         |                      ^
      27 |     });
      28 |
      29 |     it('should calculate response time percentiles', () => {

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:26:22)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should calculate response time percentiles

    expect(received).toBeDefined()

    Received: undefined

      34 |       
      35 |       const histogram = metrics.getHistogram(METRICS.HTTP_REQUEST_DURATION_MS);
    > 36 |       expect(histogram).toBeDefined();
         |                         ^
      37 |       expect(histogram?.count).toBe(100);
      38 |       expect(histogram?.sum).toBeGreaterThan(0);
      39 |     });

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:36:25)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should record database queries

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      43 |       
      44 |       const total = metrics.getCounter(METRICS.DB_QUERIES_TOTAL);
    > 45 |       expect(total).toBeGreaterThan(0);
         |                     ^
      46 |     });
      47 |
      48 |     it('should record failed database queries', () => {

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:45:21)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should record failed database queries

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      50 |       
      51 |       const errors = metrics.getCounter(METRICS.DB_ERRORS_TOTAL);
    > 52 |       expect(errors).toBeGreaterThan(0);
         |                      ^
      53 |     });
      54 |
      55 |     it('should record payment transactions', () => {

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:52:22)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should record payment transactions

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 0

      59 |       const successful = metrics.getCounter(METRICS.PAYMENT_SUCCESS_TOTAL);
      60 |       
    > 61 |       expect(total).toBe(1);
         |                     ^
      62 |       expect(successful).toBe(1);
      63 |     });
      64 |

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:61:21)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Metrics Collection Î“Ã‡â•‘ should record failed payment transactions

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 0

      69 |       const failed = metrics.getCounter(METRICS.PAYMENT_FAILURES_TOTAL);
      70 |       
    > 71 |       expect(total).toBe(1);
         |                     ^
      72 |       expect(failed).toBe(1);
      73 |     });
      74 |   });

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:71:21)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Business Metrics Î“Ã‡â•‘ should track bounty creation

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 0

      79 |       
      80 |       const summary = businessMetrics.getSummary();
    > 81 |       expect(summary.bounties.created).toBe(1);
         |                                        ^
      82 |     });
      83 |
      84 |     it('should track bounty acceptance', () => {

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:81:40)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Business Metrics Î“Ã‡â•‘ should calculate completion rate

    expect(received).toBe(expected) // Object.is equality

    Expected: 50
    Received: 0

      102 |       
      103 |       const summary = businessMetrics.getSummary();
    > 104 |       expect(summary.bounties.completionRate).toBe(50);
          |                                               ^
      105 |     });
      106 |
      107 |     it('should track payment success rate', () => {

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:104:47)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Business Metrics Î“Ã‡â•‘ should track payment success rate

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 0

      111 |       
      112 |       const summary = businessMetrics.getSummary();
    > 113 |       expect(summary.payments.total).toBe(3);
          |                                      ^
      114 |       expect(summary.payments.successful).toBe(2);
      115 |       expect(summary.payments.failed).toBe(1);
      116 |       expect(summary.payments.successRate).toBeCloseTo(66.67, 1);

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:113:38)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Business Metrics Î“Ã‡â•‘ should track user signups

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 0

      122 |       
      123 |       const summary = businessMetrics.getSummary();
    > 124 |       expect(summary.users.signups).toBe(2);
          |                                     ^
      125 |     });
      126 |   });
      127 |

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:124:37)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Alerting Î“Ã‡â•‘ should trigger high error rate alert

    expect(received).toBeDefined()

    Received: undefined

      141 |       const errorRateAlert = activeAlerts.find(a => a.rule === 'high_error_rate');
      142 |       
    > 143 |       expect(errorRateAlert).toBeDefined();
          |                              ^
      144 |       expect(errorRateAlert?.severity).toBe('critical');
      145 |     });
      146 |

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:143:30)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Alerting Î“Ã‡â•‘ should trigger slow API response alert

    expect(received).toBeDefined()

    Received: undefined

      157 |       const slowApiAlert = activeAlerts.find(a => a.rule === 'slow_api_response_time');
      158 |       
    > 159 |       expect(slowApiAlert).toBeDefined();
          |                            ^
      160 |       expect(slowApiAlert?.severity).toBe('critical');
      161 |     });
      162 |

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:159:28)

  Î“Ã¹Ã… APM Monitoring Î“Ã‡â•‘ Alerting Î“Ã‡â•‘ should trigger payment failure rate alert

    expect(received).toBeDefined()

    Received: undefined

      172 |       const paymentAlert = activeAlerts.find(a => a.rule === 'payment_failure_rate');
      173 |       
    > 174 |       expect(paymentAlert).toBeDefined();
          |                            ^
      175 |       expect(paymentAlert?.severity).toBe('critical');
      176 |     });
      177 |

      at Object.<anonymous> (services/api/src/__tests__/monitoring.test.ts:174:28)

FAIL __tests__/unit/services/refund-service.test.ts
  Î“Ã¹Ã… Test suite failed to run

    Cannot find module '../../../services/api/src/utils/logger' from '__tests__/unit/services/refund-service.test.ts'

      79 |
      80 | // Mock logger
    > 81 | jest.mock('../../../services/api/src/utils/logger', () => ({
         |      ^
      82 |   logger: {
      83 |     info: jest.fn(),
      84 |     error: jest.fn(),

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (__tests__/unit/services/refund-service.test.ts:81:6)

FAIL services/api/src/__tests__/websocket-integration.test.ts
  Î“Ã¹Ã… Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL __tests__/unit/services/completion-release-service.test.ts
  Î“Ã¹Ã… Test suite failed to run

    Cannot find module '../../../services/api/src/db' from '__tests__/unit/services/completion-release-service.test.ts'

      57 | };
      58 |
    > 59 | jest.mock('../../../services/api/src/db', () => ({
         |      ^
      60 |   db: mockDb,
      61 | }));
      62 |

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (__tests__/unit/services/completion-release-service.test.ts:59:6)


Test Suites: 11 failed, 1 skipped, 57 passed, 68 of 69 total
Tests:       68 failed, 24 skipped, 33 todo, 895 passed, 1020 total
Snapshots:   0 total
Time:        31.541 s
Ran all test suites.
